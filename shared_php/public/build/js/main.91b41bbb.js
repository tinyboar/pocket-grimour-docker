"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[330],{5148:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function i(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var o=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=this.processData(t),this.setup();var r=this.constructor;return new Proxy(this,{get:function(e,t){return!(t in e)&&t.startsWith("get")&&(e[t]=function(){return e.getData(r.convertProperty(t))}),e[t]}})},r=[{key:"convertProperty",value:function(e){var t=e.replace(/^get/,"");return t.charAt(0).toLowerCase()+t.slice(1)}}],(t=[{key:"setup",value:function(){}},{key:"processData",value:function(e){return e}},{key:"clone",value:function(){return new this.constructor(this.data)}},{key:"hasData",value:function(e){return Object.prototype.hasOwnProperty.call(this.data,e)}},{key:"getData",value:function(e){if(!this.hasData(e))throw new ReferenceError('Unrecognised property "'.concat(e,'"'));return this.data[e]}},{key:"getAllData",value:function(){return JSON.parse(JSON.stringify(this.data))}}])&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}(),c=r(6351);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}var h,v,y,p=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.template=t},r=[{key:"create",value:function(e){var t=this.cache,r=(0,c.ls)(e);return t[r]||(t[r]=new this(e)),t[r]}}],(t=[{key:"draw",value:function(e){var t=this.template.content.cloneNode(!0);return Object.entries(e).forEach(function(e){var r=s(e,2),n=r[0],a=r[1];(0,c.$I)(n,t).forEach(function(e){return a(e)})}),t}}])&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function g(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==m(t)?t:t+""}h=p,v="cache",y=Object.create(null),(v=d(v))in h?Object.defineProperty(h,v,{value:y,enumerable:!0,configurable:!0,writable:!0}):h[v]=y;var k=function(){return function(e,t,r){return t&&b(e.prototype,t),r&&b(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dummy=document.createElement("div")},[{key:"on",value:function(e,t){this.dummy.addEventListener(e,t)}},{key:"off",value:function(e,t){this.dummy.removeEventListener(e,t)}},{key:"create",value:function(e,t){return new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t})}},{key:"trigger",value:function(e,t){var r="string"==typeof e?this.create(e,t):e;return this.dummy.dispatchEvent(r),r}}],[{key:"create",value:function(e){var t=this.observers;return t[e]||(t[e]=new this),t[e]}}])}();function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,S(n.key),n)}}function S(e){var t=function(e,t){if("object"!=w(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==w(t)?t:t+""}!function(e,t,r){(t=g(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(k,"observers",Object.create(null));var O=function(){return function(e,t,r){return t&&j(e.prototype,t),r&&j(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.trick=t,this.reason=r,this.state={ready:!1,trick:!1,target:!1,active:!1}},[{key:"setTarget",value:function(e){this.target=e}},{key:"setObserver",value:function(e){this.observer=e}},{key:"toggleState",value:function(e,t){var r,n=this.state;if(!Object.prototype.hasOwnProperty.call(n,e))throw new ReferenceError('Unrecognised state "'.concat(e,'"'));(void 0===t&&(t=!n[e]),t!==n[e])&&(n[e]=t,null===(r=this.observer)||void 0===r||r.trigger("toggle-jinx-".concat(e),{jinx:this,state:t}));return t}},{key:"toggleReady",value:function(e){!1===this.toggleState("ready",e)&&this.toggleState("active",!1)}},{key:"isReady",value:function(){return this.state.ready}},{key:"activate",value:function(){this.toggleReady(!0),this.toggleState("active",!0)}},{key:"toggleTrick",value:function(e){this.toggleState("trick",e)&&this.state.target?this.activate():this.toggleState("active",!1)}},{key:"toggleTarget",value:function(e){this.toggleState("target",e)&&this.state.trick?this.activate():this.toggleState("active",!1)}},{key:"isActive",value:function(){return Boolean(this.trick)&&this.state.ready&&this.state.active}},{key:"matches",value:function(e){return Boolean(this.trick)&&this.trick.matches(e)}},{key:"getTarget",value:function(){return this.target}},{key:"getTrick",value:function(){return this.trick}},{key:"getReason",value:function(){return this.reason}},{key:"getIsHomebrew",value:function(){return Boolean(this.isHomebrew)}},{key:"setIsHomebrew",value:function(e){this.isHomebrew=e}},{key:"setTemplate",value:function(e){this.template=e}},{key:"getId",value:function(){var e;return"jinx--".concat(this.target.getId(),"-").concat((null===(e=this.trick)||void 0===e?void 0:e.getId())||"_unknown_")}},{key:"draw",value:function(){var e=this,t=this.target,r=this.trick,n=this.reason,a=this.template,i=this.constructor.drawImg;return a.draw({".js--jinx-table--jinx":function(t){t.id=e.getId()},".js--jinx-table--target":function(e){i(e,t)},".js--jinx-table--target-name":function(e){e.textContent=t.getName()},".js--jinx-table--trick":function(e){i(e,r)},".js--jinx-table--trick-name":function(e){e.textContent=(null==r?void 0:r.getName())||""},".js--jinx-table--reason":function(e){e.textContent=n}})}}],[{key:"drawImg",value:function(e,t){t&&(e.src=t.getImage(),e.alt=t.getName(),e.title=t.getName())}}])}();function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D(n.key),n)}}function T(e,t,r){return t=x(t),function(e,t){if(t&&("object"==E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,C()?Reflect.construct(t,r||[],x(e).constructor):t.apply(e,r))}function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(C=function(){return!!e})()}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}function L(e,t,r){return(t=D(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e){var t=function(e,t){if("object"!=E(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==E(t)?t:t+""}var N=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(t,e),function(e,t,r){return t&&P(e.prototype,t),r&&P(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"processData",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach(function(t){L(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({id:"",text:"",image:"",characterId:"",characterName:"",isGlobal:!1},e)}},{key:"drawToken",value:function(){var e=this.data,t=e.image,r=e.text,n=e.characterName;return this.constructor.templates.token.draw({".js--reminder--name":function(e){e.textContent=n},".js--reminder--text":function(e){e.textContent=r},".js--reminder--image":function(e){e.src=t}})}},{key:"drawList",value:function(){var e=this,t=this.data,r=t.id,n=t.isGlobal;return this.constructor.templates.list.draw({".js--reminder-list--item,.js--reminder-list--button":function(e){e.dataset.reminderId=r},".js--reminder-list--item":function(e){e.classList.toggle("is-global",n)},".js--reminder-list--button":function(t){t.append(e.drawToken())},".js--reminder-list--checkbox":function(e){e.value=r}})}}],[{key:"setTemplates",value:function(e){this.templates=e}},{key:"addGlobal",value:function(e){this.global.push(e)}},{key:"getGlobal",value:function(){return this.global}}])}(o);function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function B(e,t,r){return(t=V(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,V(n.key),n)}}function V(e){var t=function(e,t){if("object"!=F(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==F(t)?t:t+""}function G(e,t,r){return t=H(t),function(e,t){if(t&&("object"==F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,U()?Reflect.construct(t,r||[],H(e).constructor):t.apply(e,r))}function U(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(U=function(){return!!e})()}function M(){return M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=H(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},M.apply(null,arguments)}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}function J(e,t){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},J(e,t)}L(N,"global",[]);var z=Symbol("empty"),$=Symbol("custom"),q=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),G(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J(e,t)}(t,e),function(e,t,r){return t&&_(e.prototype,t),r&&_(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"processData",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach(function(t){B(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({id:"",name:"",edition:"",team:"",firstNight:0,firstNightReminder:"",otherNight:0,otherNightReminder:"",reminders:[],setup:!1,ability:"",image:"",special:null},e)}},{key:"setup",value:function(){this.isDead=!1,this.isUpsideDown=!1,this.hasGhostVote=!0,this.jinxes=[],this.reminders=[]}},{key:"clone",value:function(){var e=function(e,t,r,n){var a=M(H(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof a?function(e){return a.apply(r,e)}:a}(t,"clone",this,3)([]);return this.getReminders().forEach(function(t){e.addReminder(t.clone())}),this.getJinxes().forEach(function(t){e.addJinx(t)}),e}},{key:"addReminder",value:function(e){this.reminders.push(e)}},{key:"getReminders",value:function(){return this.reminders}},{key:"toggleDead",value:function(e){return void 0===e&&(e=!this.isDead),this.isDead=e,e&&this.toggleGhostVote(!0),this.getIsDead()}},{key:"getIsDead",value:function(){return Boolean(this.isDead)}},{key:"rotate",value:function(e){return void 0===e&&(e=!this.isUpsideDown),this.isUpsideDown=e,this.getIsUpsideDown()}},{key:"getIsUpsideDown",value:function(){return Boolean(this.isUpsideDown)}},{key:"toggleGhostVote",value:function(e){return void 0===e&&(e=!this.hasGhostVote),this.hasGhostVote=e,this.getHasGhostVote()}},{key:"getHasGhostVote",value:function(){return Boolean(this.hasGhostVote)}},{key:"matches",value:function(e){return e===this||e.getId()===this.getId()}},{key:"addJinx",value:function(e){e.setTarget(this),this.jinxes.push(e)}},{key:"readyAllJinxes",value:function(e){var t=this;e.forEach(function(e){t.toggleJinxReady(e,!0)})}},{key:"unreadyAllJinxes",value:function(){this.jinxes.forEach(function(e){return e.toggleReady(!1)})}},{key:"toggleJinxReady",value:function(e,t){this.jinxes.forEach(function(r){r.matches(e)&&r.toggleReady(t)})}},{key:"toggleJinxTrick",value:function(e,t){this.jinxes.forEach(function(r){r.matches(e)&&r.toggleTrick(t)})}},{key:"toggleJinxTarget",value:function(e){this.jinxes.forEach(function(t){return t.toggleTarget(e)})}},{key:"getJinxes",value:function(){return this.jinxes}},{key:"getReadyJinxes",value:function(){return this.jinxes.filter(function(e){return e.isReady()})}},{key:"getActiveJinxes",value:function(){return this.jinxes.filter(function(e){return e.isActive()})}},{key:"isEmpty",value:function(){return Boolean(this.data[z])}},{key:"isCustom",value:function(){return Boolean(this.data[$])}},{key:"getSpecialData",value:function(e,t){var r=this.data.special,n=Array.isArray(r);if(r&&(!n||r.length))return r.find(function(r){return r.type===e&&r.name===t})}},{key:"hasSpecialData",value:function(e,t){return Boolean(this.getSpecialData(e,t))}},{key:"drawToken",value:function(){var e=this.data,t=e.name,r=e.image,n=e.reminders,a=void 0===n?[]:n,i=e.remindersGlobal,o=void 0===i?[]:i,c=e.firstNight,u=e.otherNight,s=e.setup;return this.constructor.templates.token.draw({".js--character--leaves":function(e){e.classList.toggle("character--setup",s),e.classList.toggle("character--left-1",c),e.classList.toggle("character--right-1",u);var t=a.length+o.length;e.classList.toggle("character--top-".concat(t),t)},".js--character--image":function(e){e.src=r},".js--character--name":function(e){e.textContent=t}})}},{key:"drawList",value:function(){var e=this,t=this.data.id;return this.constructor.templates.list.draw({".js--character-list--button":function(e){e.dataset.tokenId=t},".js--character-list--token":function(t){t.append(e.drawToken())}})}},{key:"drawSelect",value:function(){var e=this.data,t=e.id,r=e.name,n=e.image,a=e.ability,i=e.setup;return this.constructor.templates.select.draw({".js--character-select--image":function(e){e.src=n},".js--character-select--name":function(e){e.textContent=r,e.classList.toggle("is-setup",i)},".js--character-select--ability":function(e){e.textContent=a},".js--character-select--input":function(e){e.value=t,e.closest("label").htmlFor=(0,c.ls)(e)},".js--character-select--count":function(e){e.name+=t,e.dataset.for=t}})}},{key:"drawNightOrder",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.data,r=t.id,n=t.name,a=t.image,i=t.firstNight,o=t.firstNightReminder,c=t.otherNight,u=t.otherNightReminder;return this.constructor.templates.nightOrder.draw({".js--night-info--wrapper":function(t){t.dataset.id=r,t.dataset.order=e?i:c},".js--night-info--icon":function(e){e.src=a},".js--night-info--role":function(e){e.textContent=n},".js--night-info--ability":function(t){t.textContent=e?o:u}})}}],[{key:"empty",get:function(){return z}},{key:"custom",get:function(){return $}},{key:"setTemplates",value:function(e){this.templates=e}}])}(o);function W(e){return String(e).replace(/(<([^>]+)>)/gi,"")}function Y(e){return e.replace(/\*\*([^*]*)\*\*/g,"<strong>$1</strong>")}function X(e,t){return e.replace(/\{([^{}]*)\}/g,function(e,r){return Object.prototype.hasOwnProperty.call(t,r)?t[r]:e})}function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function K(e,t,r){return(t=te(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,te(n.key),n)}}function te(e){var t=function(e,t){if("object"!=Z(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Z(t)?t:t+""}var re=function(){return function(e,t,r){return t&&ee(e.prototype,t),r&&ee(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=this.constructor.interpret(t)},[{key:"draw",value:function(){this.drawTrigger(),this.drawDialog()}},{key:"drawTrigger",value:function(){var e=this.data,t=e.text,r=e.id,n=e.colour,a=e.custom,i=this.constructor,o=i.holders,c=i.templates,u=o[a?"custom":"button"],s=c.button.draw({".js--info-token--button":function(e){e.textContent=t,e.style.setProperty("--bg-colour",n),e.dataset.dialog="#".concat(r)}});u.append(s),this.trigger=u.lastElementChild}},{key:"drawDialog",value:function(){var e=this.data,t=e.markup,r=e.id,n=e.colour,a=e.custom,i=this.constructor,o=i.holders,c=i.templates,u=o.dialog,s=c.dialog.draw({".js--info-token--dialog":function(e){e.id=r,e.style.setProperty("--colour",n)},".js--info-token--dialog-text":function(e){e.innerHTML=t},".js--info-token--actions":function(e){e.hidden=!a}});u.append(s),this.dialog=u.lastElementChild}},{key:"getData",value:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach(function(t){K(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},this.data)}},{key:"getRaw",value:function(){return this.data.raw}},{key:"getTrigger",value:function(){return this.trigger}},{key:"getDialog",value:function(){return this.dialog}},{key:"updateRaw",value:function(e){var t=this.data,r=this.dialog,n=this.trigger,a=Y(e),i=W(a);t.raw=e,t.text=i,(0,c.bF)(".js--info-token--button",n).textContent=i,t.markup=a,(0,c.bF)(".js--info-token--dialog-text",r).innerHTML=a}},{key:"remove",value:function(){this.dialog.remove(),this.trigger.remove()}}],[{key:"ID_PREFIX",get:function(){return"info-token-"}},{key:"setTemplates",value:function(e){this.templates=e}},{key:"setHolders",value:function(e){this.holders=e}},{key:"makeId",value:function(e){var t=e.replace(/\W/g,"").toLowerCase();return(0,c.ls)({},"".concat(this.ID_PREFIX).concat(t,"-"))}},{key:"interpret",value:function(e){var t=e.raw,r=e.markup,n=e.id,a=e.colour,i=e.custom;t&&!r&&(r=Y(t));var o=W(r);n||(n=this.makeId(o));var c=this.ID_PREFIX;return n.startsWith(c)||(n="".concat(c).concat(n)),{raw:t,text:o,markup:r,id:n,colour:"var(--".concat(a||"grey",")"),custom:Boolean(i)}}}])}();function ne(e){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(e)}function ae(e){return JSON.parse(JSON.stringify(e))}function ie(e){return e&&"object"===ne(e)&&Object.values(e).forEach(function(e){return ie(e)}),Object.freeze(e)}function oe(e){Object.keys(e).forEach(function(t){return delete e[t]})}function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return se(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?se(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach(function(t){he(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function de(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ve(n.key),n)}}function he(e,t,r){return(t=ve(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(e){var t=function(e,t){if("object"!=ce(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ce(t)?t:t+""}var ye=function(){return function(e,t,r){return t&&de(e.prototype,t),r&&de(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.key=t,this.data=this.read(),this.tokens=[],this.infoTokens=[],this.observer=new k},[{key:"addListener",value:function(e){this.observer.on("written",e)}},{key:"write",value:function(){window.localStorage.setItem(this.key,JSON.stringify(this.data)),this.observer.trigger("written",this.get())}},{key:"read",value:function(){return fe(fe({},ae(this.constructor.defaults)),JSON.parse(window.localStorage.getItem(this.key))||{})}},{key:"delete",value:function(e){var t=this.constructor.defaults;Object.prototype.hasOwnProperty.call(t,e)&&(this.data[e]=ae(t[e]),"tokens"===e&&(this.tokens.length=0,this.data.bluffs=ae(t.bluffs)),"info_tokens"===e&&(this.infoTokens.length=0),this.write())}},{key:"deleteAll",value:function(){var e=this;Object.keys(this.constructor.defaults).forEach(function(t){return e.delete(t)})}},{key:"get",value:function(){return ie(ae(this.data))}},{key:"getLookup",value:function(e){return this.data.lookup[e]}},{key:"setLookup",value:function(e,t){this.data.lookup[e]=t,this.write()}},{key:"setCharacters",value:function(e,t,r){var n={characters:t};e&&(n.name=e),r&&(n.game=r),this.data.characters=n,this.write()}},{key:"addToken",value:function(e){var t=this.data,r=this.tokens,n=r.length;return r.push(e),t.tokens[n]={id:e.getId()},this.write(),n}},{key:"removeToken",value:function(e){var t=this.data,r=this.tokens,n=r.indexOf(e);n<0||(t.tokens.splice(n,1),r.splice(n,1),this.write())}},{key:"moveToken",value:function(e,t,r,n){var a=this.data,i=this.tokens.indexOf(e);i<0&&(i=this.addToken(e)),Object.assign(a.tokens[i],{left:t,top:r,zIndex:n}),this.write()}},{key:"alignToken",value:function(e,t){var r=this.data,n=this.tokens.indexOf(e);n<0&&(n=this.addToken(e)),r.tokens[n].zIndex=t,this.write()}},{key:"toggleDead",value:function(e,t){var r=this.data,n=this.tokens.indexOf(e);n<0||(r.tokens[n].isDead=t,t?this.setGhostVote(e,!0):this.write())}},{key:"rotate",value:function(e,t){var r=this.data,n=this.tokens.indexOf(e);n<0||(r.tokens[n].isUpsideDown=t,this.write())}},{key:"setPlayerName",value:function(e,t){var r=this.data,n=this.tokens.indexOf(e);n<0||(r.tokens[n].playerName=t,r.names.includes(t)||r.names.push(t),this.write())}},{key:"setGhostVote",value:function(e,t){var r=this.data,n=this.tokens.indexOf(e);n<0||(r.tokens[n].ghostVote=t,this.write())}},{key:"saveInput",value:function(e){var t=e||{},r=t.name,n=t.form,a=t.type,i=t.value,o=t.checked,c=t.nodeName;if(r&&"file"!==a){var u="".concat(c.toLowerCase(),'[name="').concat(r,'"]'),s="checkbox"===a;s&&e.hasAttribute("value")&&(u+='[value="'.concat(i,'"]'));var l=null==n?void 0:n.id;l&&(u="#".concat(l," ").concat(u)),this.data.inputs[u]=s?o:i,this.write()}}},{key:"removeStaleInputs",value:function(){var e=this.data;e.inputs=Object.fromEntries(Object.entries(e.inputs).filter(function(e){var t=ue(e,1)[0];return(0,c.$I)(t).length})),this.write()}},{key:"saveDetails",value:function(e){var t=e||{},r=t.id,n=t.open;r&&(this.data.details["#".concat(r)]=n,this.write())}},{key:"saveInfoToken",value:function(e,t){var r=this.infoTokens,n=this.data;r.includes(e)||("number"==typeof t?r[t]=e:(r.push(e),n.infoTokens.push(e.getRaw())),this.write())}},{key:"updateInfoToken",value:function(e){var t=this.infoTokens.indexOf(e);t>-1&&(this.data.infoTokens[t]=e.getRaw(),this.write())}},{key:"removeInfoToken",value:function(e){var t=this.infoTokens,r=this.data,n=t.indexOf(e);n>-1&&(t.splice(n,1),r.infoTokens.splice(n,1),this.write())}},{key:"setHeight",value:function(e){this.data.height=e,this.write()}},{key:"setBluffs",value:function(e){this.data.bluffs=e,this.write()}},{key:"setVersion",value:function(e){this.data.version=e,this.write()}},{key:"getVersion",value:function(){return this.data.version}},{key:"setUser",value:function(e){this.data.user=e,this.write()}},{key:"getUser",value:function(){return this.data.user}}],[{key:"create",value:function(e){var t=this.cache;return t[e]||(t[e]=new this(e)),t[e]}}])}();function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ke(n.key),n)}}function ge(e,t,r){return(t=ke(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ke(e){var t=function(e,t){if("object"!=pe(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==pe(t)?t:t+""}he(ye,"defaults",{lookup:{},characters:{},bluffs:{},tokens:[],inputs:{},details:{},infoTokens:[],names:[],height:"",version:"",user:""}),he(ye,"cache",Object.create(null));var we,je,Se,Oe=function(){return function(e,t,r){return t&&be(e.prototype,t),r&&be(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){var r=this,n=t.characters,a=t.reminders,i=t.jinxes;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.characters=Object.create(null),this.reminders=Object.create(null),n.forEach(function(e){return r.createCharacter(e)}),null==a||a.forEach(function(e,t){N.addGlobal(r.createReminder(e,t))}),this.jinxes=[],i.forEach(function(e){var t=e.id,n=e.jinx,a=r.getCharacter(t);a&&n.forEach(function(e){var t=r.getCharacter(e.id);if(t){var n=new O(t,e.reason);a.addJinx(n),r.jinxes.push(n)}})})},[{key:"createCharacter",value:function(e){var t=this,r=e.name,n=e.image,a=e.reminders,i=void 0===a?[]:a,o=e.remindersGlobal,c=void 0===o?[]:o,u=this.constructor.normaliseId(e.id),s=new q(e);return i.concat(c).forEach(function(e,a){s.addReminder(t.createReminder({id:u,name:r,image:n,text:e,isGlobal:c.includes(e)},a))}),this.characters[u]=s,s}},{key:"createCustomCharacter",value:function(e){return this.createCharacter(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach(function(t){ge(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(ge({},q.custom,!0),e))}},{key:"createReminder",value:function(e,t){var r=e.name,n=e.text,a=e.image,i=e.isGlobal,o=this.constructor.normaliseId(e.id),c="".concat(o,":").concat(t).toLowerCase().replace(/\s+/g,"-"),u=new N({text:n,image:a,isGlobal:i,id:c,characterId:o,characterName:r});return this.reminders[c]=u,u}},{key:"getCharacter",value:function(e){return this.characters[this.constructor.normaliseId(e)]}},{key:"getOfficialCharacter",value:function(e){var t=this.getCharacter(e);if(null==t||!t.isCustom())return t}},{key:"getCharacterClone",value:function(e){var t=this.getCharacter(e);if(!t)throw new ReferenceError('Unable to find "'.concat(e,'" character'));return t.clone()}},{key:"getAllCharacters",value:function(){return Object.values(this.characters)}},{key:"getEmptyCharacter",value:function(){return this.getCharacterClone(this.constructor.EMPTY)}},{key:"getReminder",value:function(e){return this.reminders[e]}},{key:"getReminderClone",value:function(e){var t=this.getReminder(e);if(!t)throw new ReferenceError('Unable to find the "'.concat(e,'" reminder'));return t.clone()}},{key:"getAllReminders",value:function(){return Object.values(this.reminders)}},{key:"getAllJinxes",value:function(){return this.jinxes}},{key:"addJinx",value:function(e){this.jinxes.push(e)}},{key:"getAllHomebrewJinxes",value:function(){return this.jinxes.filter(function(e){return e.getIsHomebrew()})}},{key:"removeAllHomebrewJinxes",value:function(){this.jinxes=this.jinxes.filter(function(e){return!e.getIsHomebrew()})}}],[{key:"EMPTY",get:function(){return""}},{key:"create",value:function(e){return this.promise.resolve(new this(e))}},{key:"get",value:function(){return this.promise}},{key:"isCharacterId",value:function(e){return!this.isReminderId(e)}},{key:"isReminderId",value:function(e){return/:\d+$/.test(e)}},{key:"normaliseId",value:function(e){return e.replace(/[-_]/g,"").toLowerCase()}},{key:"ready",value:function(e){return this.get().then(e)}}])}();ge(Oe,"promise",(we=function(){},je=function(){},(Se=new Promise(function(e,t){we=e,je=t})).resolve=function(e){return we(e),Se},Se.reject=function(e){return je(e),Se},Se));var Ee=r(6973),Ie=document.documentElement.lang||"en-GB";function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function Te(e){return function(e){if(Array.isArray(e))return Ce(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ce(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ce(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ae(n.key),n)}}function Ae(e){var t=function(e,t){if("object"!=Pe(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Pe(t)?t:t+""}var Le=function(){return function(e,t,r){return t&&xe(e.prototype,t),r&&xe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.names=[]},[{key:"setTemplate",value:function(e){return this.template=e,this}},{key:"setObserver",value:function(e){return this.observer=e,this}},{key:"add",value:function(e){var t=this.names,r=this.observer;t.length;e&&!t.includes(e)&&(t.push(e),this.alphabetise(),r.trigger("names-added",{name:e,names:Te(t)}))}},{key:"alphabetise",value:function(){this.names.sort(function(e,t){return e.localeCompare(t,Ie)})}},{key:"clear",value:function(){this.names.length=0,observer.trigger("names-cleared")}},{key:"drawList",value:function(){this.constructor;var e=this.names,t=this.template;if(!t)throw new Error("Cannot draw a list because the template is not set");return e.map(function(e){return t.draw({".js--player-name--option":function(t){t.value=e}})})}},{key:"on",value:function(e,t){this.observer.on(e,t)}}],[{key:"create",value:function(){return this.instance||(this.instance=new this),this.instance}}])}();function De(e,t,r){var n=r.getLookup(e);return void 0!==n?Promise.resolve(n):fetch(t).then(function(e){return e.json()}).then(function(t){return r.setLookup(e,t),t})}function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function Fe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=Ne(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ne(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Re(e){return function(e){if(Array.isArray(e))return Ve(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_e(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||_e(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _e(e,t){if(e){if("string"==typeof e)return Ve(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ve(e,t):void 0}}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Ge=ye.create("pocket-grimoire"),Ue=k.create("game");function Me(e){var t=e.min,r=e.max,n=e.value;e.style.setProperty("--size",100*(n-t)/(r-t))}De("characters_".concat(Ie),URLS.characters,Ge).then(function(e){Ue.trigger("characters-loaded",{characters:e})}),De("jinxes_".concat(Ie),URLS.jinxes,Ge).then(function(e){Ue.trigger("jinxes-loaded",{jinxes:e})}),De("game",URLS.game,Ge).then(function(e){Ue.trigger("team-breakdown-loaded",{breakdown:e})}),q.setTemplates({token:p.create((0,c.bF)("#character-template")),list:p.create((0,c.bF)("#character-list-template")),select:p.create((0,c.bF)("#character-select-template")),nightOrder:p.create((0,c.bF)("#night-info-template"))}),N.setTemplates({token:p.create((0,c.bF)("#reminder-template")),list:p.create((0,c.bF)("#reminder-list-template"))}),Le.create().setTemplate(p.create((0,c.bF)("#player-name-template"))).setObserver(new k),Promise.all([new Promise(function(e){Ue.on("characters-loaded",function(t){var r=t.detail;e(r.characters)})}),new Promise(function(e){Ue.on("jinxes-loaded",function(t){var r=t.detail;e(r.jinxes)})})]).then(function(e){var t=Be(e,2),r=t[0],n=t[1];Oe.create({characters:[Fe({id:Oe.EMPTY,image:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",ability:I18N.emptyCharacterAbility},q.empty,!0)].concat(Re(r)),reminders:[{id:Oe.EMPTY,name:"",text:I18N.goodTeam,image:"/build/img/icons/townsfolk.webp",isGlobal:!0},{id:Oe.EMPTY,name:"",text:I18N.evilTeam,image:"/build/img/icons/demon.webp",isGlobal:!0}],jinxes:n})}),document.body.addEventListener("click",function(e){var t=e.target;t.hasAttribute("data-dialog")&&!t.dialog&&(t.dialog=Ee.A.createFromTrigger(t),t.dialog.show())}),(0,c.$I)("input[data-filter-list]").forEach(function(e){e.addEventListener("change",function(e){var t=e.target,r=(0,c.pb)(t.dataset.filterList);r&&r.classList.toggle("is-show-all",t.checked)})}),(0,c.bF)("#locale-form").addEventListener("submit",function(e){e.preventDefault(),window.location.href=(0,c.pb)("#select-locale").value}),(0,c.pb)("#select-locale").addEventListener("change",function(e){e.target.form.requestSubmit()});var He=new MutationObserver(function(e){e.forEach(function(e){var t=e.type,r=e.target;"attributes"==t&&Me(r)})});function Je(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ze(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ze(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function qe(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;k.create("game").trigger("characters-selected",{name:e,characters:t,game:r}),Ee.A.create((0,c.pb)("#edition-list")).hide()}function We(e,t){e.setCustomValidity(t),e.form.reportValidity()}(0,c.$I)('input[type="range"][data-output]').forEach(function(e){var t=(0,c.bF)(e.dataset.output);e.addEventListener("input",function(){Me(e),t&&(t.value=e.value)}),Me(e),He.observe(e,{attributes:!0,attributeFilter:["min","max","value"]})});var Ye={team:{traveler:"traveller"}};function Xe(e){var t="",r=e.findIndex(function(e){return"_meta"===e.id});return r>-1&&(t=e[r].name,e.splice(r,1)),t}function Ze(e,t){if(e.dataset.isLoading!==t&&String(e.dataset.isLoading)!==String(t)){e.dataset.isLoading=t;var r=(0,c.pb)('[type="submit"]',e);r.classList.toggle("is-loading",t);var n=(0,c.pb)('[role="progressbar"]',r);n.setAttribute("aria-busy",t),n.setAttribute("aria-valuenow",t?"0":n.getAttribute("aria-valuemax"))}}function Qe(e){var t="";return"string"==typeof e?t=e:e&&"object"===$e(e)&&(t=e.id||""),Oe.normaliseId(t)}function Ke(e){var t,r,n=e.form,a=e.json,i=e.input,o=e.store;if(!function(e){return Array.isArray(e)&&e.length&&e.every(function(e){return"object"===$e(e)&&"string"==typeof(null==e?void 0:e.id)||"string"==typeof e})}(a))return We(i,I18N.invalidScript),Promise.resolve();if(function(e){return e.filter(function(e){return"_meta"!==e.id}).some(function(e){return"string"==typeof e.ability})}(a)){var u=function(e){return e.map(function(e){return"string"==typeof e&&(e={id:e}),Object.entries(Ye).forEach(function(t){var r=Je(t,2),n=r[0],a=r[1];e[n]=a[e[n]]||e[n]}),Array.isArray(e.image)&&(e.image=e.image[0]),e.team&&!e.image&&(e.image="/build/img/icons/".concat(e.team,".png")),e})}(a);return Ze(n,!0),(t=URLS.homebrew,r=u,fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{Accept:"application/json","Content-type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(r)}).then(function(e){return e.json()})).then(function(e){var t=e.success,r=e.game,a=e.message,s=e.reasons;Ze(n,!1),t?(qe(Xe(u),u.map(function(e){return o.getOfficialCharacter(Qe(e))||o.createCustomCharacter(e)}),r),Ee.A.create((0,c.pb)("#edition-list")).hide()):(s&&s.length&&(a+="\n\n"+s.join("\n")),We(i,a))})}var s=Xe(a),l=a.map(function(e){return o.getCharacter(Qe(e))}).filter(Boolean);return l.length?(qe(s,l),Promise.resolve()):(We(i,I18N.noCharacters),Promise.resolve())}function et(e,t){if(t){var r=e.find(function(e){return e.value});e.forEach(function(e){e.required=!r||e===r})}else e.forEach(function(e){e.setCustomValidity(""),e.required=!1})}var tt=(0,c.bF)("#select-edition-form"),rt=(0,c.bF)("#custom-script-upload"),nt=rt.nextElementSibling,at=(0,c.bF)("#custom-script-url"),it=(0,c.bF)("#custom-script-paste"),ot=(0,c.bF)("#custom-script"),ct=(0,c.$I)('[name="edition"]',tt),ut=[rt,at,it];function st(e){var t=window.crypto.getRandomValues(new Uint16Array(e.length));return Array.from(e,function(e,r){return{value:e,sort:t[r]}}).sort(function(e,t){return e.sort-t.sort}).map(function(e){return e.value})}function lt(e,t,r){return Math.max(e,Math.min(t,r))}function ft(e){return Object.assign([0,0,0],e.split(".").map(Number))}function dt(e,t,r){for(var n=function(e){return Math.floor(Math.abs(e))}(e)||0,a=0;a<n;)t.call(r,a,n),a+=1;return n}function ht(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return vt(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}ct.forEach(function(e){e.addEventListener("input",function(e){var t="custom"===e.target.value;ot.hidden=!t,et(ut,t)})}),ut.forEach(function(e){e.addEventListener("input",function(){e.setCustomValidity(""),et(ut,!0)})}),tt.addEventListener("submit",function(e){if(e.preventDefault(),"true"!==tt.dataset.isLoading){var t=ct.find(function(e){return e.checked}),r=null==t?void 0:t.value;r&&Oe.ready(function(e){if("custom"===r){if(at.value){Ze(tt,!0);var n=X(window.decodeURIComponent(URLS.url),{url:window.encodeURIComponent(at.value)});fetch(n).catch(function(e){We(at,e.message),Ze(tt,!1)}).then(function(e){return e.json()}).catch(function(){return We(at,I18N.invalidScript),Ze(tt,!1),null}).then(function(t){if(null!==t)return t.success?void Ke({form:tt,json:t.data,input:at,store:e}).then(function(){return Ze(tt,!1)}):(We(at,t.message),void Ze(tt,!1))})}else if(rt.files.length){var a=new FileReader;a.addEventListener("load",function(t){var r=t.target,n=[];try{n=JSON.parse(r.result)}catch(e){return We(rt,I18N.invalidScript)}Ke({form:tt,json:n,input:rt,store:e})}),a.readAsText(rt.files[0])}else if(it.value){var i=[];try{i=JSON.parse(it.value)}catch(e){return We(it,I18N.invalidScript)}Ke({form:tt,json:i,input:it,store:e})}}else qe((0,c.wJ)(t),e.getAllCharacters().filter(function(e){return e.getEdition()===r}))})}}),rt.addEventListener("input",function(){var e=rt.value;rt.setCustomValidity(""),nt.dataset.value=e?e.slice(e.lastIndexOf("\\")+1):nt.dataset.placeholder,e&&at.value&&(at.value="",(0,c.cm)(at))}),at.addEventListener("input",function(){at.setCustomValidity(""),at.value&&rt.value&&(rt.value="",(0,c.cm)(rt))}),Ee.A.create((0,c.bF)("#edition-list")).on(Ee.A.HIDE,function(){rt.value="",(0,c.cm)(rt),at.value="",(0,c.cm)(at)});var yt=k.create("game"),pt=k.create("token");function mt(e){Object.entries(e).forEach(function(e){var t=ht(e,2),r=t[0],n=t[1];(0,c.lu)('[data-team="'.concat(r,'"] .js--character-select--total')).forEach(function(e){e.textContent=n})})}function bt(e,t){var r=(0,c.$I)('[data-team="'.concat(e,'"] [name="character"]'));if(r.length){var n=st(r).slice(0,t);r.forEach(function(e){var t=e.checked;e.checked=n.includes(e),t&&((0,c.bF)('input[name="count-'.concat(e.value,'"]')).value=1),e.checked!==t&&(0,c.cm)(e)})}}yt.on("team-breakdown-loaded",function(e){var t=e.detail,r=(0,c.pb)("#player-count");function n(){var e=t.breakdown;return e[lt(0,r.value-5,e.length-1)]}r.addEventListener("input",function(){yt.trigger("player-count",{count:Number(r.value)})}),r.addEventListener("input",function(){return mt(n())}),mt(n()),(0,c.bF)("#player-select-random").addEventListener("click",function(){var e=0;Object.entries(n()).forEach(function(t){var r=ht(t,2),n=r[0],a=r[1];bt(n,a),e+=a}),bt("traveller",r.value-e)})}),yt.on("characters-selected",function(e){var t,r=e.detail.characters,n=(t=function(e){return e.getTeam()},r.reduce(function(e,r,n){var a=t(r,n);return e[a]||(e[a]=[]),e[a].push(r),e},Object.create(null)));(0,c.lu)("[data-team]").forEach(function(e){var t=e.dataset.team,r=Array.isArray(n[t]);e.hidden=!r,(0,c.wy)((0,c.pb)(".js--character-select--list",e),(n[t]||[]).map(function(e){return e.drawSelect()})),(0,c.$I)(".js--character-select--input",e).forEach(function(e){e.checked=!1}),(0,c.pb)(".js--character-select--count",e).textContent=0,e.countInputs=(0,c.$I)('input[name^="count"]',e)});var a=15;a+=Math.min((n.traveller||[]).length,5),a=Math.min(a,r.length);var i=(0,c.pb)("#player-count");i.max=a,i.value>=a&&(i.value=a,(0,c.cm)(i)),(0,c.pb)("#select-characters").disabled=!1}),(0,c.bF)("#toggle-abilities").addEventListener("input",function(e){var t=e.target;(0,c.lu)("[data-team]").forEach(function(e){e.classList.toggle("is-hide-abilities",!t.checked)})}),(0,c.bF)("#toggle-duplicates").addEventListener("input",function(e){var t=e.target.checked;(0,c.lu)("[data-team]").forEach(function(e){e.classList.toggle("is-show-duplicates",t),t||(0,c.$I)('[name^="count-"]',e).forEach(function(e){e.value>1&&(e.value=1,(0,c.cm)(e))})})}),(0,c.lu)("[data-team]").forEach(function(e){e.addEventListener("change",function(e){var t=e.target;t.matches('input[name="character"]')&&yt.trigger("character-toggle",{element:t,id:t.value,active:t.checked})}),e.addEventListener("input",function(e){var t=e.target;t.matches('input[name^="count"]')&&yt.trigger("character-count-change",{element:t,id:t.dataset.for,count:Number(t.value)})}),e.addEventListener("click",function(e){var t=e.target.closest("[data-quantity-amount]");if(t){var r=t.input||(0,c.bF)(".js--character-select--count",t.closest(".js--character-select--duplicate-wrapper"));t.input=r;var n=(Number(r.value)||0)+(Number(t.dataset.quantityAmount)||0);if(r.value=n,n)(0,c.cm)(r);else{var a=(0,c.bF)(".js--character-select--input",t.closest(".js--character-select"));a.checked=!1,(0,c.cm)(a)}}})}),yt.on("character-toggle",function(e){var t=e.detail,r=t.id,n=t.active,a=t.element,i=(0,c.bF)('input[name="count-'.concat(r,'"]')),o=Number(i.value);a.closest(".js--character-select").classList.toggle("is-selected",n),n?o<1&&(i.value=1):i.value=0,(0,c.cm)(i)});var gt=(0,c.bF)("#player-select-validation");yt.on("character-count-change",function(e){var t=e.detail.element.closest("[data-team]");(0,c.pb)(".js--character-select--count",t).textContent=t.countInputs.reduce(function(e,t){return e+Number(t.value)},0),gt.setCustomValidity("")}),(0,c.bF)("#player-select").addEventListener("submit",function(e){e.preventDefault();var t=(0,c.$I)(".js--character-select--input:checked",e.target).map(function(e){return e.value});Oe.ready(function(r){var n=r.getAllCharacters().filter(function(e){return t.includes(e.getId())}).map(function(e){var t=[];return dt((0,c.bF)('input[name="count-'.concat(e.getId(),'"]')).value,function(){return t.push(e)}),t}).flat(),a=n.filter(function(e){return e.hasSpecialData("selection","bag-disabled")});if(a.length)gt.setCustomValidity(X(window.I18N.bagDisabled,[a.map(function(e){return e.getName()}).join(", ")])),gt.form.reportValidity();else{var i;gt.setCustomValidity("");var o=Boolean("player-select-all"===(null===(i=e.submitter)||void 0===i?void 0:i.id));yt.trigger("character-draw",{isShowAll:o,characters:o?st(n):n}),Ee.A.create((0,c.pb)("#character-select")).hide()}})}),pt.on("toggle-jinx-active",function(e){var t,r,n=e.detail,a=n.jinx,i=n.state,o=(0,c.bF)('.js--character-select--input[value="'.concat(null===(t=a.getTarget())||void 0===t?void 0:t.getId(),'"]'));o&&(null===(r=o.closest(".js--character-select--label"))||void 0===r||null===(r=r.querySelector(".js--character-select--name"))||void 0===r||r.classList.toggle("is-jinx",i))});var kt=(0,c.bF)("#breakdown-table");function wt(e){e>15&&(e=15),e=String(e);var t=(0,c.lu)("[data-count]",kt).findIndex(function(t){return t.dataset.count===e});(0,c.$I)(".is-count",kt).forEach(function(e){return e.classList.remove("is-count")}),(0,c.lu)("tbody>tr",kt).forEach(function(e){var r;null===(r=(0,c.lu)(".js--breakdown--cell",e)[t])||void 0===r||r.classList.add("is-count")})}(0,c.pb)("#player-count").addEventListener("input",function(e){wt(e.target.value)}),wt((0,c.pb)("#player-count").value);var jt=k.create("game"),St=Ee.A.create((0,c.bF)("#character-decision")),Ot=(0,c.bF)("#player-name");jt.on("character-draw",function(e){var t=e.detail;if(!t.isShowAll){var r=p.create((0,c.pb)("#character-choice-template"));(0,c.wy)((0,c.pb)("#character-choice-wrapper"),st(t.characters).map(function(e,t){return r.draw({"[data-id]":function(t){t.dataset.id=e.getId()},".js--character-choice--number":function(e){e.textContent=t+1}})})),Ee.A.create((0,c.pb)("#character-choice")).show()}}),jt.on("character-draw",function(e){var t=e.detail;t.isShowAll&&((0,c.pb)("#grimoire").open=!0,Oe.ready(function(e){t.characters.forEach(function(e){jt.trigger("character-drawn",{character:e.clone(),isAutoAdd:!0})})}))}),(0,c.pb)("#character-choice").addEventListener("click",function(e){var t=e.target.closest("[data-id]");t&&!t.disabled&&Oe.ready(function(e){jt.trigger("character-drawn",{element:t,character:e.getCharacter(t.dataset.id).clone()})})}),jt.on("character-drawn",function(e){var t=e.detail.element;t&&(t.disabled=!0)}),jt.on("character-drawn",function(e){var t=e.detail,r=t.isAutoAdd,n=t.character;r||((0,c.Ie)((0,c.pb)("#character-decision-wrapper")).append(n.drawToken()),(0,c.pb)("#character-decision-ability").textContent=n.getAbility(),St.show())});var Et=null;jt.on("character-drawn",function(e){var t=e.detail;Et=t.character}),St.on(Ee.A.SHOW,function(){Ot.value=Ot.defaultValue}),St.on(Ee.A.HIDE,function(){var e=(0,c.pb)(".js--pad").pad,t=(Ot.value||"").trim();e&&t&&Et&&e.setPlayerName(Et,t),Et=null}),(0,c.bF)("#character-decision-form").addEventListener("submit",function(e){e.preventDefault(),St.hide()});var It=r(4425),Pt=k.create("game"),Tt=Object.create(null);function Ct(){var e=(0,c.pb)("#include-travellers").checked,t=(0,c.pb)("#include-fabled").checked,r=(0,c.pb)("#qr-code"),n=(0,c.pb)("#qr-code-link"),a=new URL(n.href),i=r.dataset,o=i.name,u=i.game;if(o?a.searchParams.set("name",o):a.searchParams.delete("name"),u)a.searchParams.set("game",u),a.searchParams.set("traveller",Number(e)),a.searchParams.set("fabled",Number(t)),a.searchParams.delete("characters");else{var s=["townsfolk","outsider","minion","demon"];e&&s.push("traveller"),t&&s.push("fabled");var l=Tt[r.dataset.characters].filter(function(e){return s.includes(e.getTeam())}).map(function(e){return e.getId()});a.searchParams.set("characters",l),a.searchParams.delete("game"),a.searchParams.delete("traveller"),a.searchParams.delete("fabled")}(0,c.Ie)(r).append((0,It.A)({msg:a.toString(),ecl:"L"})),(0,c.pb)("#qr-code-button").disabled=!1,n.href=a.toString(),(0,c.pb)("#qr-code-link").disabled=!1}Pt.on("characters-selected",function(e){var t=e.detail,r=t.name,n=t.characters,a=t.game,i=(0,c.pb)("#qr-code");if(a)i.dataset.game=a,delete i.dataset.characters;else{var o=JSON.stringify(n.map(function(e){return e.getId()}));Tt[o]=n,i.dataset.characters=o,delete i.dataset.game}r?i.dataset.name=r:delete i.dataset.name,Ct()}),(0,c.pb)("#include-travellers").addEventListener("change",function(){Ct()}),(0,c.pb)("#include-fabled").addEventListener("change",function(){Ct()});var xt=ye.create("pocket-grimoire"),At=(0,c.lu)('input[name="clear"]');function Lt(){}function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}function Nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ft(n.key),n)}}function Ft(e){var t=function(e,t){if("object"!=Dt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Dt(t)?t:t+""}(0,c.bF)("#clear-all").addEventListener("change",function(e){var t=e.target;(0,c.pb)("#clear-individual").hidden=t.checked,t.checked&&At.forEach(function(e){e.checked=!0,(0,c.cm)(e)})}),(0,c.bF)("#clear-tokens").addEventListener("change",function(e){var t=e.target;(0,c.pb)("#token-warning").hidden=!t.checked}),(0,c.bF)("#clear-infoTokens").addEventListener("change",function(e){var t=e.target;(0,c.pb)("#info-token-warning").hidden=!t.checked}),(0,c.bF)("#cache-form").addEventListener("submit",function(e){e.preventDefault(),At.forEach(function(e){var t=e.value;e.checked&&xt.delete(t)}),(0,c.pb)("#clear-refresh").checked&&window.location.reload(),Ee.A.create((0,c.pb)("#clear-cache")).hide()});var Rt,Bt=function(){return function(e,t,r){return t&&Nt(e.prototype,t),r&&Nt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pad=t,this.observer=r,this.reset(),this.updatePadDimensions(),this.addListeners()},[{key:"reset",value:function(){this.zIndex=0,this.dragHandler=Lt,this.isDragging=!1,this.xOffset=0,this.yOffset=0}},{key:"updatePadDimensions",value:function(){var e=this.pad.getBoundingClientRect();this.padLeft=e.left,this.padTop=e.top,this.padWidth=e.width,this.padHeight=e.height}},{key:"addListeners",value:function(){var e=this;document.addEventListener("mousedown",this),document.addEventListener("touchstart",this),document.addEventListener("mouseup",this),document.addEventListener("touchend",this),document.addEventListener("click",this),document.addEventListener("contextmenu",this),window.addEventListener("resize",this),window.addEventListener("scroll",this),new MutationObserver(function(){e.updatePadDimensions()}).observe(this.pad,{attributes:!0,attributeFilter:["style"]})}},{key:"setZIndex",value:function(e){this.zIndex=e}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"advanceZIndex",value:function(){return this.zIndex+=1,this.zIndex}},{key:"handleEvent",value:function(e){var t=this,r=e.target,n="function"==typeof r.closest?r.closest(".js--token--wrapper"):null,a=function(e){var t=this,r=!0;return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];r&&(r=!1,window.requestAnimationFrame(function(){r=!0,e.apply(t,a)}))}}(function(e){return t.onScroll(e)});switch(e.type){case"mousedown":case"touchstart":this.onMousedown(n,e);break;case"mouseup":case"touchend":case"contextmenu":this.onMouseup(e);break;case"click":this.onClick(n,e);break;case"resize":this.onResize(e);break;case"scroll":a(e)}}},{key:"onMousedown",value:function(e,t){if(e){this.startDrag(e,t);var r=this.advanceZIndex();e.style.setProperty("--z-index",r),this.observer.trigger("zindex",{zIndex:r,element:e})}}},{key:"onMouseup",value:function(e){this.endDragging()}},{key:"onClick",value:function(e,t){if(e&&!this.isDragging){var r=e.closest("[data-token]"),n=r.dataset.token;this.observer.trigger("".concat(n,"-click"),{element:r})}}},{key:"onResize",value:function(e){this.updatePadDimensions()}},{key:"onScroll",value:function(e){this.updatePadDimensions()}},{key:"startDrag",value:function(e,t){var r=this,n=t.type,a=t.clientX,i=t.clientY,o=t.targetTouches,c=e.getBoundingClientRect(),u=c.left,s=c.top;this.endDragging(),this.dragHandler=function(t){return r.dragObject(e,t)},"mousedown"===n?(this.xOffset=a-u+this.padLeft,this.yOffset=i-s+this.padTop,window.addEventListener("mousemove",this.dragHandler)):"touchstart"===n&&o.length&&(this.xOffset=o[0].clientX-u+this.padLeft,this.yOffset=o[0].clientY-s+this.padTop,window.addEventListener("touchmove",this.dragHandler,{passive:!1}))}},{key:"dragObject",value:function(e,t){t.preventDefault();var r=t.type,n=t.clientX,a=t.clientY,i=t.targetTouches,o=e.getBoundingClientRect(),c=o.width,u=o.height,s=0,l=0;"mousemove"===r?(s=n-this.xOffset,l=a-this.yOffset,this.isDragging=!0):"touchmove"===r&&i.length&&(s=i[0].clientX-this.xOffset,l=i[0].clientY-this.yOffset),this.moveTo(e,lt(0,s,this.padWidth-c),lt(0,l,this.padHeight-u))}},{key:"moveTo",value:function(e,t,r,n){e.style.setProperty("--left",t),e.style.setProperty("--top",r),("number"!=typeof n||Number.isNaN(n))&&(n=this.zIndex),e.style.setProperty("--z-index",n),this.observer.trigger("move",{element:e,left:t,top:r,zIndex:n})}},{key:"getPosition",value:function(e){return{x:Number(e.style.getPropertyValue("--left"))||0,y:Number(e.style.getPropertyValue("--top"))||0,z:Number(e.style.getPropertyValue("--z-index"))||0}}},{key:"endDragging",value:function(){var e=this;this.dragHandler!==Lt&&(window.removeEventListener("mousemove",this.dragHandler),window.removeEventListener("touchmove",this.dragHandler,{passive:!1}),this.dragHandler=Lt,window.requestAnimationFrame(function(){return e.isDragging=!1}))}}])}();function _t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Vt(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Gt(e){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gt(e)}function Ut(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Mt(n.key),n)}}function Mt(e){var t=function(e,t){if("object"!=Gt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Gt(t)?t:t+""}var Ht=function(){return function(e,t,r){return t&&Ut(e.prototype,t),r&&Ut(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setDefaults()},[{key:"setDefaults",value:function(){var e={width:0,height:0};this.setContainerSize(e),this.setTokenSize(e),this.setTotal(0)}},{key:"setContainerSize",value:function(e){var t=e.width,r=e.height;this.width=Number(t)||0,this.height=Number(r)||0}},{key:"setTokenSize",value:function(e){var t=e.width,r=e.height;this.tokenWidth=Number(t)||0,this.tokenHeight=Number(r)||0}},{key:"setTotal",value:function(e){this.total=Number(e)||0}},{key:"setLayout",value:function(e){this.layout=e}},{key:"getData",value:function(){return Object.freeze({width:this.width,height:this.height,tokenWidth:this.tokenWidth,tokenHeight:this.tokenHeight,total:this.total})}},{key:"generateCoords",value:function(){var e=this.constructor.layouts,t=this.layout,r=e[t];if(!r)throw new ReferenceError('Unrecognised layout type "'.concat(t,'"'));return r(this.getData())}}])}();function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return $t(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$t(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function qt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wt(n.key),n)}}function Wt(e){var t=function(e,t){if("object"!=Jt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Jt(t)?t:t+""}Rt=Ht,function(e,t,r){(t=Mt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Ht,"layouts",{ellipse:function(e){var t=e.width,r=e.height,n=e.tokenWidth,a=e.tokenHeight,i=e.total,o=[],c=(t-n)/2,u=(r-a)/2;function s(e){return Math.sqrt(Math.pow(c*Math.sin(e),2)+Math.pow(u*Math.cos(e),2))}for(var l=-.5*Math.PI,f=0,d=0+l;d<2*Math.PI+l;d+=.001)f+=s(d);var h=0,v=0;for(d=0+l;d<2*Math.PI+l;d+=.001){if(i*v/f>=h){h++;var y=c+Math.cos(d)*c,p=u+Math.sin(d)*u;o.push([y,p])}v+=s(d)}return o},diagonal:function(e){var t=e.width,r=e.height,n=e.tokenWidth,a=e.tokenHeight,i=e.total,o=[],c=(t-n)/i,u=(r-a)/i;return dt(i,function(e){o[e]=[c*e,u*e]}),o},horizontal:function(e){return Rt.layouts.diagonal(e).map(function(e){var t=_t(e,2),r=t[0];t[1];return[r,0]})},vertical:function(e){return Rt.layouts.diagonal(e).map(function(e){var t=_t(e,2);t[0];return[0,t[1]]})}});var Yt=function(){return function(e,t,r){return t&&qt(e.prototype,t),r&&qt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.observer=r,this.tokens=new Bt(t,r),this.template=p.create((0,c.bF)("#token-template")),this.characters=[],this.reminders=[],this.positioner=null,this.coords=[],this.tokenStore=null},[{key:"drawCharacter",value:function(e){var t=this.element,r=this.characters,n=this.template;t.append(n.draw({".js--token--wrapper":function(t){t.append(e.drawToken()),t.dataset.token="character"}}));var a=t.lastElementChild,i=Object.freeze({character:e,token:a});return r.push(i),i}},{key:"addCharacter",value:function(e){var t=this.drawCharacter(e);return this.observer.trigger("character-add",t),t}},{key:"addNewCharacter",value:function(e){var t=this.tokens,r=this.characters,n=this.coords,a=this.constructor.OFFSET;if(!n)throw new Error("Co-ordinates have not been generated");var i=this.addCharacter(e),o=r.length-1,c=zt((null==n?void 0:n[o])||[a*o,a,o],2),u=c[0],s=c[1];return t.moveTo(i.token,u,s,t.advanceZIndex()),i}},{key:"moveToken",value:function(e,t,r,n){this.tokens.moveTo(e,t,r,n)}},{key:"getTokenPosition",value:function(e){return this.tokens.getPosition(e)}},{key:"undrawCharacter",value:function(e){var t=this.characters,r=this.preserveReference,n=t.findIndex(function(t){return t.character===e});if(!(n<0)){var a=t[n].token;return a.remove(),r||t.splice(n,1),a}}},{key:"removeCharacter",value:function(e){var t=this.undrawCharacter(e);t&&this.observer.trigger("character-remove",{character:e,token:t})}},{key:"getCharacterByToken",value:function(e){var t;return null===(t=this.characters.find(function(t){return t.token===e}))||void 0===t?void 0:t.character}},{key:"removeCharacterByToken",value:function(e){this.removeCharacter(this.getCharacterByToken(e))}},{key:"getInfoByCharacter",value:function(e){return this.characters.find(function(t){return t.character===e})}},{key:"toggleDead",value:function(e,t){var r=(this.getInfoByCharacter(e)||{}).token;if(r){var n=e.toggleDead(t);this.constructor.getToken(r).classList.toggle("is-dead",n),this.observer.trigger("shroud-toggle",{isDead:n,token:r,character:e}),n||this.setGhostVote(e,!0)}}},{key:"toggleDeadByToken",value:function(e,t){this.toggleDead(this.getCharacterByToken(e),t)}},{key:"rotate",value:function(e,t){var r=(this.getInfoByCharacter(e)||{}).token;if(r){var n=e.rotate(t);this.constructor.getToken(r).classList.toggle("is-upside-down",n),this.observer.trigger("rotate-toggle",{isUpsideDown:n,token:r,character:e})}}},{key:"rotateByToken",value:function(e,t){this.rotate(this.getCharacterByToken(e),t)}},{key:"getPlayerName",value:function(e){var t=this.characters.find(function(t){return t.character===e});if(!t)return"";var r=(0,c.pb)(".js--character--player-name",this.constructor.getToken(t.token));return(null==r?void 0:r.textContent)||""}},{key:"getPlayerNameForToken",value:function(e){return this.getPlayerName(this.getCharacterByToken(e))}},{key:"setPlayerName",value:function(e,t){var r=(this.getInfoByCharacter(e)||{}).token;if(r){var n=(0,c.pb)(".js--character--player-name",this.constructor.getToken(r));n&&(t=(t||"").trim(),n.textContent=t,this.observer.trigger("set-player-name",{name:t,token:r,character:e}))}}},{key:"setPlayerNameForToken",value:function(e,t){this.setPlayerName(this.getCharacterByToken(e),t)}},{key:"setGhostVote",value:function(e,t){if(t||e.getIsDead()){var r=(this.getInfoByCharacter(e)||{}).token;if(r){var n=e.toggleGhostVote(t);this.constructor.getToken(r).classList.toggle("is-voteless",!n),this.observer.trigger("ghost-vote-toggle",{hasGhostVote:n,token:r,character:e})}}}},{key:"setGhostVoteForToken",value:function(e,t){this.setGhostVote(this.getCharacterByToken(e),t)}},{key:"addReminder",value:function(e){var t=this.element,r=this.reminders,n=this.observer,a=this.template;t.append(a.draw({".js--token--wrapper":function(t){t.append(e.drawToken()),t.dataset.token="reminder",t.dataset.reminder=e.getId()}}));var i=t.lastElementChild,o=Object.freeze({reminder:e,token:i});return r.push(o),n.trigger("reminder-add",o),o}},{key:"removeReminder",value:function(e){var t=this.reminders,r=this.observer,n=t.findIndex(function(t){return t.reminder===e});if(!(n<0)){var a=t[n].token;a.remove(),this.preserveReference||t.splice(n,1),r.trigger("reminder-remove",{reminder:e,token:a})}}},{key:"getReminderByToken",value:function(e){var t;return null===(t=this.reminders.find(function(t){return t.token===e}))||void 0===t?void 0:t.reminder}},{key:"removeReminderByToken",value:function(e){this.removeReminder(this.getReminderByToken(e))}},{key:"reset",value:function(){var e=this,t=this.characters,r=this.reminders;this.preserveReference=!0,t.forEach(function(t){var r=t.character;e.removeCharacter(r)}),t.length=0,r.forEach(function(t){var r=t.reminder;e.removeReminder(r)}),r.length=0,this.preserveReference=!1,this.tokens.reset()}},{key:"updateDimensions",value:function(){this.tokens.updatePadDimensions()}},{key:"setZIndex",value:function(e){this.tokens.setZIndex(e)}},{key:"setPositioner",value:function(e){this.positioner=e}},{key:"generateCoords",value:function(){this.coords=this.positioner.generateCoords()}},{key:"getPadDimensions",value:function(){var e=this.element.getBoundingClientRect();return{width:e.width,height:e.height}}},{key:"setTokenStore",value:function(e){this.tokenStore=e}},{key:"getTokenDimensions",value:function(){var e={width:0,height:0};if(!this.tokenStore)return console.warn("Cannot test dimensions because tokenStore is not set"),e;var t=this.tokenStore.getEmptyCharacter(),r=this.drawCharacter(t).token,n=r.getBoundingClientRect(),a=n.width,i=n.height,o=Number(window.getComputedStyle(r,null).getPropertyValue("--token-size")||1),c=r.querySelector(".js--character"),u=window.getComputedStyle(c,null),s=u.getPropertyValue("--shadow-offset"),l=parseFloat(s)*o;return"em"===s.trim().replace(/[\d\.]/g,"")&&(l*=parseFloat(u.getPropertyValue("font-size"))),e.width=a+l,e.height=i+l,this.undrawCharacter(t),e}},{key:"updatePositioner",value:function(e){var t,r,n=e.container,a=e.tokens,i=e.total,o=e.layout,c=e.generate,u=void 0===c||c,s=this.positioner;if(!s)throw new ReferenceError("The positioner has not been set");n&&s.setContainerSize(this.getPadDimensions()),a&&s.setTokenSize(this.getTokenDimensions()),o&&s.setLayout(o),i&&(t=i,r=window.parseFloat(t),!Number.isNaN(r)&&Number.isFinite(r))&&s.setTotal(i),u&&this.generateCoords()}}],[{key:"getToken",value:function(e){var t=(0,c.pb)(".js--character",e);if(!t)throw new ReferenceError("Unable to find character token");return t}}])}(),Xt=k.create("game"),Zt=k.create("token"),Qt=(0,c.pb)(".js--pad"),Kt=new Yt(Qt,Zt);Qt.pad=Kt,new MutationObserver(function(e){Xt.trigger("pad-height-change",{height:e[0].target.style.height})}).observe(Qt,{attributes:!0,attributeFilter:["style"]}),(0,c.$I)("details").forEach(function(e){e.addEventListener("toggle",function(){Kt.updateDimensions()})}),Xt.on("characters-selected",function(e){var t=e.detail.characters.filter(function(e){var t=e.getTeam();return"fabled"!==t&&"traveller"!==t});(0,c.wy)((0,c.pb)("#character-list__list"),t.map(function(e){return e.drawList()}));var r=t.reduce(function(e,t){return e.concat(t.getReminders())},N.getGlobal());(0,c.wy)((0,c.pb)("#reminder-list__list"),r.map(function(e){return e.drawList()})),(0,c.pb)("#add-token").disabled=!1,(0,c.pb)("#add-reminder").disabled=!1,(0,c.pb)("#show-tokens").disabled=!1}),Xt.on("character-drawn",function(e){var t=e.detail;Kt.addNewCharacter(t.character)}),(0,c.bF)("#show-night-order").addEventListener("change",function(e){var t=e.target;Qt.style[t.checked?"removeProperty":"setProperty"]("--night-order-display","none")}),Xt.on("clear",function(){return Kt.reset()});var er=document.documentElement;(0,c.bF)("#token-size").addEventListener("input",function(e){var t=e.target;er.style.setProperty("--token-size",t.value)}),(0,c.bF)("#reminder-size").addEventListener("input",function(e){var t=e.target;er.style.setProperty("--reminder-size",t.value)}),Kt.setPositioner(new Ht);var tr=(0,c.bF)("#token-layout");function rr(e){return rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rr(e)}function nr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ar(n.key),n)}}function ar(e){var t=function(e,t){if("object"!=rr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=rr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==rr(t)?t:t+""}Kt.updatePositioner({layout:tr.value,generate:!1}),tr.addEventListener("change",function(){Kt.updatePositioner({layout:tr.value})}),Xt.on("player-count",function(e){var t=e.detail;Kt.updatePositioner({total:t.count})}),Xt.on("pad-height-change",function(){Kt.updatePositioner({container:!0})}),Ee.A.create((0,c.pb)("#character-select")).on(Ee.A.SHOW,function(){var e=(0,c.pb)("#grimoire"),t=e.open;t||(e.open=!0),Kt.updatePositioner({container:!0,tokens:!0,total:(0,c.pb)("#player-count").value}),t||(e.open=!1)}),Oe.ready(function(e){Kt.setTokenStore(e)});var ir=function(){return function(e,t,r){return t&&nr(e.prototype,t),r&&nr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.list=[]},[{key:"add",value:function(e){this.list.push(e)}},{key:"has",value:function(e){return this.list.includes(e)}},{key:"addUnique",value:function(e){this.has(e)||this.add(e)}},{key:"remove",value:function(e){var t=this.list.indexOf(e);t>-1&&this.list.splice(t,1)}},{key:"last",value:function(){return this.list[this.list.length-1]}}],[{key:"execute",value:function(e,t){if("function"==typeof(null==e?void 0:e[t])){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];e[t].apply(e,n)}}}])}();function or(e){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},or(e)}function cr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ur(n.key),n)}}function ur(e){var t=function(e,t){if("object"!=or(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=or(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==or(t)?t:t+""}function sr(e,t,r){return t=dr(t),function(e,t){if(t&&("object"==or(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,lr()?Reflect.construct(t,r||[],dr(e).constructor):t.apply(e,r))}function lr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(lr=function(){return!!e})()}function fr(){return fr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=dr(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},fr.apply(null,arguments)}function dr(e){return dr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dr(e)}function hr(e,t){return hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},hr(e,t)}var vr=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=sr(this,t,[e])).processList=new ir,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hr(e,t)}(t,e),function(e,t,r){return t&&cr(e.prototype,t),r&&cr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"addProcess",value:function(e){this.processList.addUnique(e)}},{key:"removeProcess",value:function(e){this.processList.remove(e)}},{key:"addListeners",value:function(){var e=this;!function(e,t,r,n){var a=fr(dr(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof a?function(e){return a.apply(r,e)}:a}(t,"addListeners",this,3)([]),this.dialog.addEventListener("click",function(t){var r=t.target.closest("[data-token-id]");r&&ir.execute(e.processList.last(),"click",r.dataset.tokenId)}),this.on(this.constructor.HIDE,function(){ir.execute(e.processList.last(),"hide")})}}],[{key:"get",value:function(){return this.create((0,c.pb)("#character-list"))}}])}(Ee.A);function yr(e){return yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yr(e)}function pr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mr(n.key),n)}}function mr(e){var t=function(e,t){if("object"!=yr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=yr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==yr(t)?t:t+""}var br=function(){return function(e,t,r){return t&&pr(e.prototype,t),r&&pr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.title=t,this.input=r,this.list=r.list,!this.title||!this.input||!this.list)throw new Error("Settable title not properly configured");this.form=r.form,this.start=this.list.querySelector(".js--settable-title--start"),this.start.value=t.textContent,this.previous=this.list.querySelector(".js--settable-title--previous"),this.addListeners()},[{key:"addListeners",value:function(){var e=this,t=this.title,r=this.input,n=this.form;t.addEventListener("click",function(){e.showInput(),r.focus()}),r.addEventListener("focus",function(){r.value=""}),r.addEventListener("blur",function(){e.hideInput(),e.updatePrevious()}),r.addEventListener("input",function(){e.setTitle(r.value),e.announceUpdate()}),null==n||n.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),r.blur()})}},{key:"isShowingInput",value:function(){return!this.input.hidden}},{key:"toggleInput",value:function(e){if(void 0===e&&(e=!this.isShowingInput()),e!==this.isShowingInput()){var t=this.title,r=this.input;t.hidden=e,r.hidden=!e}}},{key:"showInput",value:function(){this.toggleInput(!0)}},{key:"hideInput",value:function(){this.toggleInput(!1)}},{key:"updatePrevious",value:function(){var e=this.input,t=this.previous;t&&e.value&&(t.value=e.value)}},{key:"setTitle",value:function(e){this.title.textContent=e||this.getStartText()}},{key:"getTitle",value:function(){return this.title.textContent}},{key:"getForm",value:function(){return this.form}},{key:"setStartText",value:function(e){var t=this.start;t&&(t.value=e)}},{key:"getStartText",value:function(){var e;return(null===(e=this.start)||void 0===e?void 0:e.value)||""}},{key:"announceUpdate",value:function(){}}])}();function gr(e){return gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gr(e)}function kr(e){return function(e){if(Array.isArray(e))return wr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return wr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function jr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sr(n.key),n)}}function Sr(e){var t=function(e,t){if("object"!=gr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=gr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==gr(t)?t:t+""}var Or=function(){return function(e,t,r){return t&&jr(e.prototype,t),r&&jr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.settings=Object.assign({},e.defaults,r||{}),this.children=new Set,this.dragged=null,this.createHandlers(),this.addEventListeners()},[{key:"createHandlers",value:function(){var e=this,t=this.settings,r=t.dragClass,n=t.dragSelector;this.onChildDragStart=function(t){var a=t.target,i=t.dataTransfer,o=a.closest(n);o.classList.add(r),i&&(i.effectAllowed="move",i.setData("text/plain",null)),e.dragged=o},this.onChildDragEnd=function(e){var t;null===(t=e.target.closest(n))||void 0===t||t.classList.remove(r)}}},{key:"getClosestElement",value:function(e,t,r){return kr(e).reduce(function(e,n){var a=n.getBoundingClientRect(),i=t-a.left-a.width/2,o=r-a.top-a.height/2,c=Math.sqrt(Math.pow(i,2)+Math.pow(o,2));return c<e.offset?{offset:c,element:n}:e},{offset:Number.POSITIVE_INFINITY}).element}},{key:"isBefore",value:function(e,t){if(e.parentNode===t.parentNode)for(var r=e.previousSibling;r&&r.nodeType!==Node.DOCUMENT_NODE;r=r.previousSibling)if(r===t)return!0;return!1}},{key:"move",value:function(e){var t=e.dataTransfer,r=e.targetTouches,n=r?r[0]:e,a=this.dragged,i=this.children,o=this.container;if(n&&a){e.preventDefault(),t&&(t.dropEffect="move");var c=this.getClosestElement(i,n.clientX,n.clientY);c&&o.insertBefore(a,this.isBefore(a,c)?c:c.nextElementSibling)}}},{key:"addEventListeners",value:function(){var e=this,t=this.container;t.addEventListener("dragover",function(t){return e.move(t)}),t.addEventListener("touchmove",function(t){return e.move(t)}),t.addEventListener("drop",function(e){return e.preventDefault()})}},{key:"addChild",value:function(e){e.classList.add(this.settings.childClass),e.setAttribute("draggable",!0),e.addEventListener("dragstart",this.onChildDragStart),e.addEventListener("dragend",this.onChildDragEnd),e.addEventListener("touchstart",this.onChildDragStart),e.addEventListener("touchend",this.onChildDragEnd),this.children.add(e)}},{key:"removeChild",value:function(e){var t=this.children;t.has(e)&&(e.classList.remove(this.settings.childClass),e.removeAttribute("draggable"),e.removeEventListener("dragstart",this.onChildDragStart),e.removeEventListener("dragend",this.onChildDragEnd),e.removeEventListener("touchstart",this.onChildDragStart),e.removeEventListener("touchend",this.onChildDragEnd),t.delete(e))}},{key:"removeAllChildren",value:function(){var e=this;kr(this.children).forEach(function(t){return e.removeChild(t)})}}])}();function Er(e){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Er(e)}function Ir(e){return function(e){if(Array.isArray(e))return Pr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Pr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Tr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Cr(n.key),n)}}function Cr(e){var t=function(e,t){if("object"!=Er(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Er(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Er(t)?t:t+""}function xr(e,t,r){return t=Nr(t),function(e,t){if(t&&("object"==Er(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ar()?Reflect.construct(t,r||[],Nr(e).constructor):t.apply(e,r))}function Ar(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ar=function(){return!!e})()}function Lr(e,t,r,n){var a=Dr(Nr(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof a?function(e){return a.apply(r,e)}:a}function Dr(){return Dr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Nr(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},Dr.apply(null,arguments)}function Nr(e){return Nr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nr(e)}function Fr(e,t){return Fr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fr(e,t)}!function(e,t,r){(t=Sr(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Or,"defaults",{childClass:"is-draggable",dragClass:"is-dragging",dragSelector:"[draggable]"});var Rr=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=xr(this,t,[e])).tokenStore=null,r.entryTemplate=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fr(e,t)}(t,e),function(e,t,r){return t&&Tr(e.prototype,t),r&&Tr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"run",value:function(){this.setIds([]),this.discoverElements(),this.activateSettableTitle(),this.activateDraggable(),Lr(t,"run",this,3)([])}},{key:"addListeners",value:function(){var e=this;Lr(t,"addListeners",this,3)([]);var r=this.constructor,n=r.SHOW,a=r.HIDE,i=this.dialog;this.on(n,function(){return e.drawCharacters()}),this.on(a,function(){return e.setMultipleTitle("")}),i.addEventListener("click",function(t){var r=t.target.closest(".js--token--remove"),n=null==r?void 0:r.closest(".js--token--item");n&&(e.removeIdByIndex((0,c.Dx)(n)),e.drawCharacters())})}},{key:"discoverElements",value:function(){var e=this.dialog;this.holder=(0,c.bF)(".js--token--holder",e)}},{key:"activateSettableTitle",value:function(){var e=this.dialog;this.settableTitle=new br(e.querySelector(".js--settable-title--title"),e.querySelector(".js--settable-title--input"))}},{key:"activateDraggable",value:function(){this.draggable=new Or(this.holder)}},{key:"addId",value:function(e){this.ids.push(e)}},{key:"removeId",value:function(e){this.ids=this.ids.filter(function(t){return t!==e})}},{key:"removeIdByIndex",value:function(e){e<0||this.ids.splice(e,1)}},{key:"setIds",value:function(e){this.ids=e}},{key:"getIds",value:function(){return Ir(this.ids)}},{key:"setTokenStore",value:function(e){this.tokenStore=e}},{key:"setEntryTemplate",value:function(e){this.entryTemplate=e}},{key:"getCharacters",value:function(){var e=this.tokenStore;if(!e)throw new Error("tokenStore has not been set");return this.ids.map(function(t){return e.getCharacter(t)})}},{key:"getMultipleTitle",value:function(){var e;return this.multipleTitle||(null===(e=this.settableTitle.getForm())||void 0===e?void 0:e.dataset.multiple)||""}},{key:"setMultipleTitle",value:function(e){this.multipleTitle=e}},{key:"drawCharacters",value:function(){var e,t=this.holder,r=this.settableTitle,n=this.draggable,a=this.entryTemplate;if(!a)throw new Error("entryTemplate has not been set");var i=this.getCharacters(),o=i.length>1;n.removeAllChildren(),(0,c.wy)(t,i.map(function(e){return a.draw({".js--token--show":function(t){t.append(e.drawToken())},".js--token--ability":function(t){t.textContent=e.getAbility(),t.hidden=o}})}));var u=o?this.getMultipleTitle():(null===(e=i[0])||void 0===e?void 0:e.getName())||"";r.setStartText(u),r.setTitle(u),t.classList.toggle("is-multiple",o),o&&t.querySelectorAll(".js--token--item").forEach(function(e){n.addChild(e)})}}],[{key:"get",value:function(){return this.create((0,c.pb)("#token"))}}])}(Ee.A),Br=k.create("game"),_r=k.create("token"),Vr=(0,c.pb)(".js--pad").pad,Gr=(0,c.pb)("#character-show-reminders"),Ur=Ee.A.create((0,c.pb)("#character-show")),Mr=Rr.get();function Hr(e){return(0,c.bF)(e.closest("[data-token]").dataset.token)}function Jr(e){Ee.A.create(e.closest(".dialog")).hide()}Mr.setEntryTemplate(new p((0,c.bF)("#token-entry-template"))),_r.on("character-click",function(e){var t=e.detail.element,r=Vr.getCharacterByToken(t);Ur.getElement().dataset.token="#".concat((0,c.ls)(t)),(0,c.pb)("#character-show-name").textContent=r.getName(),(0,c.pb)("#character-show-ability").textContent=r.getAbility(),Gr.dataset.coords=JSON.stringify(Vr.getTokenPosition(t)),Ur.show()}),_r.on("reminder-add",function(e){var t=e.detail.reminder,r=t.getId(),n=(0,c.$I)(".js--reminder-list--item",Gr),a=n.find(function(e){return e.dataset.reminderId===r});a&&a===n[0]||((n.length>2||a&&a!==n[0])&&(a||n[n.length-1]).remove(),Gr.prepend(t.drawList()))}),Oe.ready(function(){(0,c.bF)("#character-show-token").addEventListener("click",function(e){var t=e.target;Mr.setIds([Vr.getCharacterByToken(Hr(t)).getId()]),Mr.show(),Jr(t)})}),(0,c.bF)("#character-shroud-toggle").addEventListener("click",function(e){var t=e.target;Vr.toggleDeadByToken(Hr(t)),Jr(t)}),(0,c.bF)("#character-rotate").addEventListener("click",function(e){var t=e.target;Vr.rotateByToken(Hr(t)),Jr(t)}),(0,c.bF)("#character-reminder").addEventListener("click",function(e){var t=e.target,r=(0,c.pb)("#reminder-list"),n=Hr(t);r.dataset.coords=JSON.stringify(Vr.getTokenPosition(n)),Ee.A.create(r).show(),Jr(t)});var zr=vr.get();zr.addProcess({click:function(e){Oe.ready(function(t){Vr.addCharacter(t.getCharacterClone(e))}),zr.hide()}});var $r={data:null,click:function(e){var t=this;Oe.ready(function(r){var n=Vr.addCharacter(r.getCharacterClone(e)),a=n.character,i=n.token,o=t.data;if(o){var u=o.token,s=o.coords,l=s.x,f=s.y,d=s.z,h=Vr.getCharacterByToken((0,c.bF)(u));Vr.toggleDead(a,h.getIsDead()),Vr.rotate(a,h.getIsUpsideDown()),Vr.setPlayerName(a,Vr.getPlayerName(h)),Vr.removeCharacter(h),Vr.moveToken(i,l,f,d)}}),zr.hide()},hide:function(){this.data=null,zr.removeProcess($r)}};(0,c.bF)("#character-replace").addEventListener("click",function(e){var t=e.target,r=Hr(t);$r.data={coords:Vr.getTokenPosition(r),token:"#".concat((0,c.ls)(r))},zr.addProcess($r),zr.show(),Jr(t)});var qr={click:function(e){Mr.addId(e),Mr.show(),zr.hide()},hide:function(){zr.removeProcess(qr)}};(0,c.bF)(".js--token--add").addEventListener("click",function(){zr.addProcess(qr),zr.show(),Mr.hide()});var Wr=(0,c.bF)("#character-name-input");(0,c.bF)("#character-name").addEventListener("click",function(e){var t=e.target,r=(Wr.value||"").trim();Vr.setPlayerNameForToken(Hr(t),r),Jr(t)});var Yr=(0,c.pb)("#character-ghost-vote");function Xr(e){Yr.disabled=!e.getIsDead()||!e.getHasGhostVote()}(0,c.pb)("#character-show").addEventListener(Ee.A.SHOW,function(e){var t=e.target,r=(0,c.bF)(t.dataset.token);Xr(Vr.getCharacterByToken(r))}),Yr.addEventListener("click",function(e){var t=e.target,r=Hr(t);Vr.setGhostVoteForToken(r,!1),Xr(Vr.getCharacterByToken(r)),Jr(t)}),Ur.on(Ee.A.SHOW,function(){var e=Hr(Ur.getElement());Wr.value=Vr.getPlayerNameForToken(e),(0,c.pb)("#character-show-orphan").hidden=!e.classList.contains("is-orphan")}),Ur.on(Ee.A.HIDE,function(){Wr.value=Wr.defaultValue}),(0,c.bF)("#character-remove").addEventListener("click",function(e){var t=e.target;Vr.removeCharacterByToken(Hr(t)),Jr(t)});var Zr={first:Object.create(null),other:Object.create(null)};function Qr(e,t){var r=0;(function(e){return Object.keys(e).sort(function(e,t){return Number(e)-Number(t)})})(e).forEach(function(n){var a=e[n];r+=1,a.forEach(function(e){var n=e.token;Yt.getToken(n).dataset[t]=r})})}function Kr(){Qr(Zr.first,"firstNight"),Qr(Zr.other,"otherNight")}_r.on("character-add",function(e){var t=e.detail,r=t.character,n=t.token,a=Zr.first,i=Zr.other,o=r.getFirstNight();o&&(a[o]||(a[o]=[]),a[o].push({character:r,token:n}));var c=r.getOtherNight();c&&(i[c]||(i[c]=[]),i[c].push({character:r,token:n})),Kr()}),_r.on("character-remove",function(e){var t=e.detail,r=t.character,n=t.token,a=Zr.first,i=Zr.other,o=r.getFirstNight(),c=a[o];if(c){var u=c.findIndex(function(e){return e.token===n});u>-1&&c.splice(u,1),c.length||delete a[o]}var s=r.getOtherNight(),l=i[s];if(l){var f=l.findIndex(function(e){return e.token===n});f>-1&&l.splice(f,1),l.length||delete i[s]}Kr()});var en=p.create((0,c.bF)("#token-list-template")),tn=(0,c.bF)("#token-list__list");Br.on("characters-selected",function(e){var t=e.detail.characters.filter(function(e){return"traveller"!==e.getTeam()});(0,c.wy)(tn,t.map(function(e){return en.draw({".js--token-list--button":function(t){t.dataset.tokenId=e.getId()},".js--token-list--token":function(t){t.append(e.drawToken())}})}))}),Br.on("characters-selected",function(e){var t=e.detail;Oe.ready(function(e){Vr.characters.forEach(function(e){var r=e.character,n=e.token;if(!["traveller","fabled"].includes(r.getTeam())){var a=t.characters.findIndex(function(e){return e.getId()===r.getId()});n.classList.toggle("is-orphan",a<0)}}),Vr.reminders.forEach(function(r){var n=r.reminder,a=r.token,i=e.getCharacter(n.getCharacterId());if(!["traveller","fabled"].includes(i.getTeam())){var o=t.characters.findIndex(function(e){return e.getId()===i.getId()});a.classList.toggle("is-orphan",o<0)}})})}),Oe.ready(function(e){Mr.setTokenStore(e);var t=Ee.A.create((0,c.bF)("#token-list"));tn.addEventListener("click",function(e){var r=e.target.closest("[data-token-id]");r&&(Mr.setIds([r.dataset.tokenId]),Mr.show(),t.hide())})});var rn=Le.create();rn.on("names-added",function(){(0,c.wy)((0,c.pb)("#player-name-options"),rn.drawList()),(0,c.wy)((0,c.pb)("#character-name-input-options"),rn.drawList())}),rn.on("names-cleared",function(){empty((0,c.pb)("#player-name-options")),empty((0,c.pb)("#character-name-input-options"))});var nn=k.create("token"),an=(0,c.pb)(".js--pad").pad,on=(0,c.pb)("#reminder-list"),cn=Ee.A.create(on);function un(e){return JSON.parse(e.dataset.coords||"null")}function sn(e,t,r){var n=null==e?void 0:e.closest("[data-reminder-id]");if(n){var a=t.getReminderClone(n.dataset.reminderId),i=an.addReminder(a).token;r&&an.moveToken(i,r.x,r.y),cn.hide()}}function ln(e){return ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ln(e)}function fn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dn(n.key),n)}}function dn(e){var t=function(e,t){if("object"!=ln(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ln(t)?t:t+""}function hn(e,t,r){return t=pn(t),function(e,t){if(t&&("object"==ln(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,vn()?Reflect.construct(t,r||[],pn(e).constructor):t.apply(e,r))}function vn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(vn=function(){return!!e})()}function yn(){return yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=pn(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},yn.apply(null,arguments)}function pn(e){return pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pn(e)}function mn(e,t){return mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mn(e,t)}Oe.ready(function(e){var t=!1;(0,c.pb)("#reminder-list__list").addEventListener("click",function(r){var n=r.target;t?function(e){var t=e.closest("[data-reminder-id]"),r=(0,c.bF)('.js--reminder-list--checkbox[value="'.concat(null==t?void 0:t.dataset.reminderId,'"]'));t&&r&&(r.checked=!r.checked)}(n):(sn(n,e,un(on)),cn.hide())});var r=(0,c.bF)("#multiple-reminders"),n=(0,c.bF)(".js--reminder-list--multiple");r.addEventListener("change",function(){var e=r.checked;t=e,n.hidden=!e,e||(0,c.$I)(".js--reminder-list--checkbox").forEach(function(e){e.checked=!1})}),n.addEventListener("click",function(){var t=un(on)||{x:0,y:0};(0,c.$I)(".js--reminder-list--checkbox:checked").forEach(function(r){t.x+=15,t.y+=15,sn((0,c.bF)('.js--reminder-list--button[data-reminder-id="'.concat(r.value,'"]')),e,t),r.checked=!1}),cn.hide()});var a=(0,c.pb)("#character-show-reminders");a.addEventListener("click",function(t){sn(t.target,e,un(a)),Ee.A.create((0,c.pb)("#character-show")).hide()});var i=Ee.A.create((0,c.bF)("#reminder-show")),o=(0,c.bF)("#reminder-show-token");nn.on("reminder-click",function(t){var r=t.detail.element,n=e.getReminder(r.dataset.reminder);(0,c.Ie)(o).append(n.drawToken()),o.dataset.token="#".concat((0,c.ls)(r)),(0,c.pb)("#reminder-show-orphan").hidden=!r.classList.contains("is-orphan"),i.show()}),(0,c.bF)("#reminder-remove").addEventListener("click",function(){var e=(0,c.bF)(o.dataset.token);e&&(an.removeReminderByToken(e),i.hide())});var u=Object.create(null),s=(0,c.pb)("#reminder-list__list");nn.on("character-add",function(e){var t=e.detail.character,r=t.getId();u[r]||(u[r]=0),u[r]+=1,t.getReminders().forEach(function(e){var t;null===(t=(0,c.bF)('[data-reminder-id="'.concat(e.getId(),'"]'),s))||void 0===t||t.classList.add("is-in-play")})}),nn.on("character-remove",function(e){var t=e.detail.character,r=t.getId();u[r]&&(u[r]-=1),u[r]||t.getReminders().forEach(function(e){var t;null===(t=(0,c.bF)('[data-reminder-id="'.concat(e.getId(),'"]'),s))||void 0===t||t.classList.remove("is-in-play")})}),(0,c.bF)("#show-all-reminders").addEventListener("change",function(e){var t=e.target;s.classList.toggle("is-show-all",t.checked)})}),cn.on(Ee.A.HIDE,function(e){e.target.removeAttribute("data-coords")});var bn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),hn(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mn(e,t)}(t,e),function(e,t,r){return t&&fn(e.prototype,t),r&&fn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"display",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.dialog,n=(0,c.pb)("#bluff-show-token",r);(0,c.pb)("#bluff-show-name",r).textContent=e.getName(),(0,c.pb)("#bluff-show-ability",r).textContent=e.getAbility(),(0,c.pb)("#bluff-show-orphan",r).hidden=!t,n.disabled=e.isEmpty(),n.dataset.characterId=e.getId()}}],[{key:"createFromTrigger",value:function(e){e.dataset.dialog=e.dataset.bluffDialog,function(e,t,r,n){var a=yn(pn(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof a?function(e){return a.apply(r,e)}:a}(t,"createFromTrigger",this,2)([e])}}])}(Ee.A);function gn(e){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gn(e)}function kn(e){return function(e){if(Array.isArray(e))return wn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return wn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function jn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sn(n.key),n)}}function Sn(e){var t=function(e,t){if("object"!=gn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=gn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==gn(t)?t:t+""}var On=function(){return function(e,t,r){return t&&jn(e.prototype,t),r&&jn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.characters=[this.getEmptyCharacter(),this.getEmptyCharacter(),this.getEmptyCharacter()],this.index=0},[{key:"getEmptyCharacter",value:function(){var e=this.constructor.emptyCharacter;if(!e)throw new Error('The "No character" character needs to be set.');return e.clone()}},{key:"validateIndex",value:function(e){if((e=Number(e))<0||e>=this.characters.length)throw new RangeError("BluffSet invalid index ".concat(e));return e}},{key:"getCharacters",value:function(){return kn(this.characters)}},{key:"getCharacter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.index;return this.characters[this.validateIndex(e)]}},{key:"setCharacter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.index;e||(e=this.getEmptyCharacter()),this.characters[this.validateIndex(t)]=e}},{key:"unsetCharacter",value:function(e){this.unsetCharacterByIndex(this.characters.indexOf(e))}},{key:"unsetCharacterByIndex",value:function(e){this.characters[this.validateIndex(e)]=this.getEmptyCharacter()}},{key:"setIndex",value:function(e){this.index=this.validateIndex(e)}},{key:"getIndex",value:function(){return this.index}},{key:"serialise",value:function(){return this.characters.map(function(e){return e.getId()})}}],[{key:"setEmptyCharacter",value:function(e){this.emptyCharacter=e}}])}();function En(e){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},En(e)}function In(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pn(n.key),n)}}function Pn(e){var t=function(e,t){if("object"!=En(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=En(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==En(t)?t:t+""}var Tn=function(){return function(e,t,r){return t&&In(e.prototype,t),r&&In(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.index=0,this.bluffSet=t},[{key:"setElement",value:function(e){this.element=e}},{key:"getElement",value:function(){return this.element}},{key:"setIndex",value:function(e){this.index=e,this.element&&(this.element.dataset.groupId=this.index)}},{key:"serialise",value:function(){var e=this.bluffSet,t=this.settableTitle;return{name:(null==t?void 0:t.getTitle())||"",set:e.serialise()}}},{key:"draw",value:function(){var e=this;return this.constructor.template.draw({".js--demon-bluffs--group":function(t){t.dataset.groupId=e.index}})}},{key:"getSelector",value:function(){return'.js--demon-bluffs--group[data-group-id="'.concat(this.index,'"]')}},{key:"getSetIndex",value:function(){return this.bluffSet.getIndex()}},{key:"setSetIndex",value:function(e){return this.bluffSet.setIndex(e)}},{key:"setCharacter",value:function(e,t){this.bluffSet.setCharacter(e,t)}},{key:"getCharacter",value:function(e){return this.bluffSet.getCharacter(e)}},{key:"display",value:function(){var e=this.element;if(!e)throw new Error("Cannot display group because there is no element");e.scrollIntoView({block:"nearest"})}},{key:"ready",value:function(){var e=this.element,t=this.bluffSet,r=this.constructor.READY;e&&(this.display(),t.getCharacters().forEach(function(t,r){var n=(0,c.bF)('.js--demon-bluffs--bluff[data-index="'.concat(r,'"]'),e);(0,c.Ie)(n).append(t.drawToken())}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,cancelable:!1,detail:{bluffGroup:this}})))}},{key:"remove",value:function(){var e;null===(e=this.element)||void 0===e||e.remove()}},{key:"redrawButton",value:function(){var e=this.element,t=this.bluffSet,r=t.getIndex(),n=t.getCharacter(r);(0,c.Ie)((0,c.bF)('.js--demon-bluffs--bluff[data-index="'.concat(r,'"]'),e)).append(n.drawToken())}},{key:"setSettableTitle",value:function(e){this.settableTitle=e,this.settableTitleTitle&&(e.setTitle(this.settableTitleTitle),delete this.settableTitleTitle)}},{key:"setTitle",value:function(e){var t=this.settableTitle;t?t.setTitle(e):this.settableTitleTitle=e}}],[{key:"READY",get:function(){return"bluff-group-ready"}},{key:"setTemplate",value:function(e){this.template=e}}])}();function Cn(e){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(e)}function xn(e,t){return xn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xn(e,t)}function An(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(An=function(){return!!e})()}function Ln(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dn(n.key),n)}}function Dn(e){var t=function(e,t){if("object"!=Cn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Cn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Cn(t)?t:t+""}var Nn=function(){return function(e,t,r){return t&&Ln(e.prototype,t),r&&Ln(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.groups=[],this.container=t,this.visibleGroupIndex=0,this.announceUpdates=!0,this.observer=new IntersectionObserver(function(e){e.forEach(function(e){var t=e.target;e.intersectionRatio>=.9&&t.dispatchEvent(new CustomEvent(r.constructor.VISIBLE,{bubbles:!0,cancelable:!1}))})},{root:t,threshold:[.9,.95,1]})},[{key:"createEmptyGroup",value:function(){}},{key:"addEmpty",value:function(){this.add(this.createEmptyGroup())}},{key:"add",value:function(e){if(!e)throw new Error("Cannot add a non-existent group");this.has(e)||(e.setIndex(this.groups.push(e)-1),this.container.append(e.draw()),e.setElement(this.container.querySelector(e.getSelector())),this.observer.observe(e.getElement()),e.ready(),this.maybeAnnounceUpdate())}},{key:"has",value:function(e){return this.groups.includes(e)}},{key:"getIndex",value:function(e){return this.groups.indexOf(e)}},{key:"remove",value:function(e){this.removeByIndex(this.getIndex(e))}},{key:"removeByIndex",value:function(e){var t=this.groups;if(!((e=Number(e))<0||e>=t.length)){var r=t[e];this.observer.unobserve(r.getElement()),r.remove(),t.splice(e,1),this.updateIndicies(),this.maybeAnnounceUpdate()}}},{key:"removeAll",value:function(){for(var e=this.groups.length;e;)e-=1,this.removeByIndex(e)}},{key:"updateIndicies",value:function(){this.groups.forEach(function(e,t){return e.setIndex(t)})}},{key:"getVisibleGroupIndex",value:function(){return this.visibleGroupIndex}},{key:"setVisibleGroupIndex",value:function(e){if((e=Number(e))<0||e>this.groups.length)throw new RangeError("Visible index ".concat(e," is out of range"));this.visibleGroupIndex=e,this.maybeAnnounceUpdate()}},{key:"getVisibleGroup",value:function(){var e=this.groups[this.visibleGroupIndex];if(!e)throw new Error("Cannot find group at index ".concat(this.visibleGroupIndex));return e}},{key:"setInnerIndex",value:function(e){this.getVisibleGroup().setSetIndex(e)}},{key:"getInnerIndex",value:function(){return this.getVisibleGroup().getSetIndex()}},{key:"setCharacter",value:function(e){this.getVisibleGroup().setCharacter(e),this.maybeAnnounceUpdate()}},{key:"redraw",value:function(){this.getVisibleGroup().redrawButton()}},{key:"serialise",value:function(){return{index:this.visibleGroupIndex,groups:this.groups.map(function(e){return e.serialise()})}}},{key:"disableAnnouncements",value:function(){this.announceUpdates=!1}},{key:"enableAnnouncements",value:function(){this.announceUpdates=!0}},{key:"maybeAnnounceUpdate",value:function(){this.announceUpdates&&this.announceUpdate()}},{key:"announceUpdate",value:function(){}},{key:"convertId",value:function(e){}},{key:"ready",value:function(e){var t=this,r=e.index,n=e.groups;this.removeAll(),n.forEach(function(e){var r=e.name,n=e.set,a=t.createEmptyGroup();if(!a)throw new Error("Cannot create an empty group");a.setTitle(r),n.forEach(function(e,r){a.setCharacter(t.convertId(e),r)}),t.add(a)}),this.setVisibleGroupIndex(r),this.getVisibleGroup().display()}}],[{key:"VISIBLE",get:function(){return"bluff-group-visible"}},{key:"getEmptyData",value:function(){return ae({index:0,groups:[{set:[]}]})}},{key:"get",value:function(){return this.instance}},{key:"create",value:function(){var e=this.instance;if(!e){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e=function(e,t,r){if(An())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var a=new(e.bind.apply(e,n));return r&&xn(a,r.prototype),a}(this,r),this.instance=e}return e}}])}();function Fn(e){return function(e){if(Array.isArray(e))return Rn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Rn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Rn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Bn=k.create("game"),_n=k.create("token"),Vn=Rr.get(),Gn=bn.create((0,c.bF)("#bluff-show"));Tn.setTemplate(p.create((0,c.bF)("#demon-bluffs-template"))),Oe.ready(function(e){On.setEmptyCharacter(e.getEmptyCharacter());var t=(0,c.bF)("#demon-bluffs-group"),r=Nn.create(t);function n(e,t){(0,c.pb)("#character-list__bluffs").classList.toggle(e,t)}r.createEmptyGroup=function(){return new Tn(new On)},r.convertId=function(t){return e.getCharacter(t)},r.announceUpdate=function(){_n.trigger("bluff",{data:r.serialise()})},t.addEventListener("click",function(e){var t=e.target.closest(".js--demon-bluffs--remove"),n=null==t?void 0:t.closest(".js--demon-bluffs--group");t&&n&&r.removeByIndex(n.dataset.groupId)}),t.addEventListener("click",function(e){var t=e.target.closest(".js--demon-bluffs--bluff[data-index]");t&&(r.setInnerIndex(t.dataset.index),Gn.display(r.getVisibleGroup().getCharacter(),t.classList.contains("is-orphan")))}),t.addEventListener(Nn.VISIBLE,function(e){var t=e.target;r.setVisibleGroupIndex(t.dataset.groupId)}),t.addEventListener(Tn.READY,function(e){var t=e.detail.bluffGroup,n=t.getElement();(0,c.$I)("[data-bluff-dialog]",n).forEach(function(e){e.dialog=bn.createFromTrigger(e)});var a=new br(n.querySelector(".js--settable-title--title"),n.querySelector(".js--settable-title--input"));a.announceUpdate=function(){return r.announceUpdate()},t.setSettableTitle(a)}),r.disableAnnouncements(),r.ready(Nn.getEmptyData()),r.enableAnnouncements(),(0,c.bF)("#add-bluffs").addEventListener("click",function(){r.addEmpty()}),Bn.on("characters-selected",function(t){var r=t.detail,n=p.create((0,c.pb)("#character-list-template")),a=[e.characters[Oe.EMPTY]].concat(Fn(r.characters));(0,c.wy)((0,c.pb)("#character-list__bluffs"),a.map(function(e){return n.draw({".js--character-list--item":function(t){t.dataset.characterId=e.getId(),t.dataset.team=e.getTeam()},".js--character-list--button":function(t){t.dataset.tokenId=e.getId()},".js--character-list--token":function(t){t.append(e.drawToken())}})}))}),(0,c.bF)("#show-existing").addEventListener("change",function(e){n("is-show-existing",e.target.checked)}),(0,c.bF)("#show-travellers").addEventListener("change",function(e){n("is-show-travellers",e.target.checked)}),(0,c.bF)("#show-evil").addEventListener("change",function(e){n("is-show-evil",e.target.checked)});var a=Object.create(null);_n.on("character-add",function(e){var t=e.detail.character.getId();a[t]||(a[t]=0),a[t]+=1}),_n.on("character-remove",function(e){var t=e.detail.character.getId();a[t]&&(a[t]-=1),(!a[t]||a[t]<0)&&delete a[t]});var i=Ee.A.create((0,c.bF)("#bluff-list"));i.on(Ee.A.SHOW,function(){Object.keys(a).concat(r.getVisibleGroup().serialise().set).filter(Boolean).forEach(function(e){var t=(0,c.bF)('#character-list__bluffs [data-character-id="'.concat(e,'"]'));null==t||t.classList.add("is-in-play")})}),i.on(Ee.A.HIDE,function(){(0,c.$I)("#character-list__bluffs .is-in-play").forEach(function(e){e.classList.remove("is-in-play")})}),(0,c.bF)("#character-list__bluffs").addEventListener("click",function(t){var n=t.target.closest("[data-token-id]");if(n){var a=e.getCharacter(n.dataset.tokenId);r.setCharacter(a),r.redraw(),i.hide(),Gn.hide()}}),(0,c.pb)("#bluff-show-token",Gn.getElement()).addEventListener("click",function(e){var t,r=null===(t=e.target.closest("[data-character-id]"))||void 0===t?void 0:t.dataset.characterId;r&&(Vn.setIds([r]),Vn.show(),Gn.hide())}),(0,c.pb)("#show-all-bluffs").addEventListener("click",function(e){var t=e.target;Vn.setIds(r.getVisibleGroup().serialise().set),Vn.setMultipleTitle(t.dataset.title),Vn.show()}),Bn.on("clear",function(){r.removeAll(),r.addEmpty()}),Bn.on("characters-selected",function(e){var t=e.detail;Oe.ready(function(){var e=r.getVisibleGroup();e.element.querySelectorAll(".js--demon-bluffs--bluff").forEach(function(r){var n=r.dataset.index,a=e.bluffSet.characters[n];if(a.getId()!==On.emptyCharacter.getId()){var i=t.characters.findIndex(function(e){return e.getId()===a.getId()});r.classList.toggle("is-orphan",i<0)}})})})});var Un=k.create("game");function Mn(e){return Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mn(e)}function Hn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Jn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Hn(Object(r),!0).forEach(function(t){zn(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hn(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function zn(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=Mn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Mn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Mn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(0,c.bF)("#reset-height").addEventListener("click",function(){(0,c.pb)(".js--pad").style.height=""}),(0,c.bF)("#clear-grimoire").addEventListener("click",function(e){var t=e.target;window.confirm(t.dataset.confirm)&&Un.trigger("clear")});var $n=k.create("game"),qn=k.create("token"),Wn=Object.create(null),Yn=Object.create(null),Xn=null;function Zn(){var e=Object.values(Jn(Jn({},Wn),Yn));Xn||(Xn=p.create((0,c.pb)("#character-list-template"))),(0,c.wy)((0,c.pb)("#traveller-list__list"),e.map(function(e){return Xn.draw({".js--character-list--item,.js--character-list--button":function(t){t.dataset.tokenId=e.getId()},".js--character-list--token":function(t){t.append(e.drawToken())}})})),(0,c.pb)("#add-traveller").disabled=!1}Oe.ready(function(e){oe(Wn),e.getAllCharacters().filter(function(e){return"traveller"===e.getTeam()}).forEach(function(e){return Wn[e.getId()]=e}),Zn()}),$n.on("characters-selected",function(e){var t=e.detail;oe(Yn),t.characters.filter(function(e){return"traveller"===e.getTeam()}).forEach(function(e){return Yn[e.getId()]=e}),Zn();var r=t.characters.filter(function(e){return"traveller"===e.getTeam()}).map(function(e){return e.getId()});(0,c.$I)(".js--character-list--item[data-token-id]",(0,c.pb)("#traveller-list__list")).forEach(function(e){return e.classList.toggle("is-included",r.includes(e.dataset.tokenId))})});var Qn=(0,c.pb)(".js--pad").pad;(0,c.pb)("#traveller-list__list").addEventListener("click",function(e){var t=e.target.closest("[data-token-id]");t&&Oe.ready(function(e){Qn.addCharacter(e.getCharacter(t.dataset.tokenId)),Ee.A.create((0,c.pb)("#traveller-list")).hide()})});var Kn=Object.create(null);function ea(e){return ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ea(e)}function ta(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ra(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ta(Object(r),!0).forEach(function(t){na(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ta(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function na(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=ea(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ea(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ea(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}qn.on("character-add",function(e){var t=e.detail.character;if("traveller"===t.getTeam()){var r=t.getId();Kn[r]||(Kn[r]=0),Kn[r]+=1}}),qn.on("character-remove",function(e){var t=e.detail.character;if("traveller"===t.getTeam()){var r=t.getId();Kn[r]&&(Kn[r]-=1)}}),qn.on("character-add",function(e){var t=e.detail.character;"traveller"===t.getTeam()&&t.getReminders().forEach(function(e){(0,c.pb)("#reminder-list__list").append(e.drawList())})}),qn.on("character-remove",function(e){var t=e.detail.character,r=Kn[t.getId()];"traveller"!==t.getTeam()||r||t.getReminders().forEach(function(e){var t;null===(t=(0,c.bF)('[data-reminder-id="'.concat(e.getId(),'"]'),(0,c.pb)("#reminder-list__list")))||void 0===t||t.remove()})});var aa=k.create("game"),ia=k.create("token"),oa=Object.create(null),ca=Object.create(null),ua=null;function sa(){var e=Object.values(ra(ra({},ca),oa));ua||(ua=p.create((0,c.pb)("#character-list-template"))),(0,c.wy)((0,c.pb)("#fabled-list__list"),e.map(function(e){return ua.draw({".js--character-list--item,.js--character-list--button":function(t){t.dataset.tokenId=e.getId()},".js--character-list--token":function(t){t.append(e.drawToken())}})})),(0,c.pb)("#add-fabled").disabled=!1}aa.on("characters-selected",function(e){var t=e.detail;oe(oa),t.characters.filter(function(e){return"fabled"===e.getTeam()}).forEach(function(e){return oa[e.getId()]=e}),sa()}),Oe.ready(function(e){oe(ca),e.getAllCharacters().filter(function(e){return"fabled"===e.getTeam()}).forEach(function(e){return ca[e.getId()]=e}),sa()});var la=(0,c.pb)(".js--pad").pad;(0,c.pb)("#fabled-list__list").addEventListener("click",function(e){var t=e.target.closest("[data-token-id]");t&&Oe.ready(function(e){la.addCharacter(e.getCharacter(t.dataset.tokenId)),Ee.A.create((0,c.pb)("#fabled-list")).hide()})});var fa=Object.create(null);ia.on("character-add",function(e){var t=e.detail.character;if("fabled"===t.getTeam()){var r=t.getId();fa[r]||(fa[r]=0),fa[r]+=1}}),ia.on("character-remove",function(e){var t=e.detail.character;if("fabled"===t.getTeam()){var r=t.getId();fa[r]&&(fa[r]-=1)}}),ia.on("character-add",function(e){var t=e.detail.character;"fabled"===t.getTeam()&&t.getReminders().forEach(function(e){(0,c.pb)("#reminder-list__list").append(e.drawList())})}),ia.on("character-remove",function(e){var t=e.detail.character,r=fa[t.getId()];"fabled"!==t.getTeam()||r||t.getReminders().forEach(function(e){var t;null===(t=(0,c.bF)('[data-reminder-id="'.concat(e.getId(),'"]'),(0,c.pb)("#reminder-list__list")))||void 0===t||t.remove()})});var da=Object.create(null);ye.create("pocket-grimoire").addListener(function(e){var t=e.detail;oe(da),Object.assign(da,{script:t.characters.name,date:(new Date).toISOString(),day:1,players:t.tokens.map(function(e){return{tokens:[],name:e.playerName,me:!1,dead:e.isDead,id:window.crypto.randomUUID(),suspectedRole:{id:e.id}}})})});var ha=(0,c.bF)("#export-trigger"),va=(0,c.bF)("#export-holder"),ya=(0,c.bF)("#export-image");ha.addEventListener("click",function(){ha.classList.add("is-loading"),fetch("https://qr-thing.netlify.app/.netlify/functions/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(da)}).then(function(e){return e.json()}).then(function(e){ya.src=e.qr,ha.classList.remove("is-loading"),va.hidden=!1})}),Ee.A.create((0,c.bF)("#game-export")).on(Ee.A.HIDE,function(){va.hidden=!0,ha.classList.remove("is-loading")});var pa=k.create("game"),ma=k.create("token");function ba(e){return ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ba(e)}function ga(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ka(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ka(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function wa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ja(n.key),n)}}function ja(e){var t=function(e,t){if("object"!=ba(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ba(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ba(t)?t:t+""}Oe.ready(function(e){var t=Object.create(null),r=p.create((0,c.bF)("#jinx-table-template"));function n(e){var r,n=null===(r=e.getTrick())||void 0===r?void 0:r.getId();if(n&&t[n]){var a=t[n].indexOf(e.getTarget().getId());a<0||(t[n].splice(a,1),t[n].length||delete t[n])}}function a(e){e.setObserver(ma),e.setTemplate(r),function(e){var r,n=null===(r=e.getTrick())||void 0===r?void 0:r.getId();n&&(t[n]||(t[n]=[]),t[n].push(e.getTarget().getId()))}(e)}e.getAllJinxes().forEach(a),pa.on("characters-selected",function(t){var r=t.detail;e.getAllJinxes().forEach(function(e){return e.toggleReady(!1)}),e.getAllHomebrewJinxes().forEach(n),e.removeAllHomebrewJinxes();var i=r.characters;i.forEach(function(t){t.hasData("jinxes")&&t.getData("jinxes").forEach(function(r){var n=r.id,o=r.reason,c=e.getCharacter(n)||i.find(function(e){return e.getId()===n}),u=new O(c,o);u.setIsHomebrew(!0),t.addJinx(u),a(u),e.addJinx(u)}),t.readyAllJinxes(i)});var o=e.getAllJinxes();pa.trigger("jinxes-ready",{jinxes:o.filter(function(e){return e.isReady()})})}),pa.on("character-toggle",function(r){var n,a=r.detail,i=a.id,o=a.active,c=e.getCharacter(i);c.toggleJinxTarget(o),null===(n=t[i])||void 0===n||n.forEach(function(t){e.getCharacter(t).toggleJinxTrick(c,o)})});var i=(0,c.bF)("#jinxes"),o=(0,c.bF)("#jinx-table");pa.on("jinxes-ready",function(e){var t=e.detail.jinxes;i.hidden=0===t.length,(0,c.wy)(o,t.map(function(e){return e.draw()}))}),ma.on("toggle-jinx-active",function(e){var t,r=e.detail,n=r.jinx,a=r.active;null===(t=(0,c.bF)("#".concat(n.getId())))||void 0===t||t.classList.toggle("is-active",a)});var u=[];function s(e){var t=Object.create(null);e.getJinxes().forEach(function(e){e.toggleTarget(!0),t[e.getTrick().getId()]=e}),u.forEach(function(r){var n;r.toggleJinxTrick(e,!0),null===(n=t[r.getId()])||void 0===n||n.toggleTrick(!0)}),u.push(e)}function l(e){var t=e.getId();u.splice(u.indexOf(e),1),u.find(function(e){return e.getId()===t})||(e.getJinxes().forEach(function(e){return e.toggleTarget(!1)}),u.forEach(function(t){return t.toggleJinxTrick(e,!1)}))}ma.on("character-add",function(e){s(e.detail.character)}),ma.on("character-remove",function(e){l(e.detail.character)}),ma.on("reminder-add",function(t){var r=t.detail.reminder,n=e.getCharacter(r.getCharacterId());r.getIsGlobal()&&r.getId().endsWith(":0")&&n.hasSpecialData("reveal","replace-character")&&s(n)}),ma.on("reminder-remove",function(t){var r=t.detail.reminder,n=e.getCharacter(r.getCharacterId());r.getIsGlobal()&&r.getId().endsWith(":0")&&n.hasSpecialData("reveal","replace-character")&&l(n)}),(0,c.bF)("#show-all-jinxes").addEventListener("change",function(e){var t=e.target;o.classList.toggle("is-show-all",t.checked)})});var Sa=function(){return function(e,t,r){return t&&wa(e.prototype,t),r&&wa(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.showDead=!1,this.showNotInPlay=!1,this.data=[],this.holders={first:null,other:null}},[{key:"setHolders",value:function(e){this.holders=e}},{key:"reset",value:function(){var e=this.data;e.forEach(function(e){var t=e.first,r=e.other;t&&(t.placeholder.remove(),t.element.remove()),r&&(r.placeholder.remove(),r.element.remove())}),e.length=0}},{key:"setShowDead",value:function(e){this.showDead=e,this.drawAllCharacters()}},{key:"setShowNotInPlay",value:function(e){this.showNotInPlay=e,this.drawAllCharacters()}},{key:"setCharacters",value:function(e){var t=this;e.forEach(function(e){return t.setCharacter(e)})}},{key:"setCharacter",value:function(e){var t={character:e,alive:0,inPlay:0},r=e.getFirstNight(),n=e.getOtherNight(),a=e.getId();r&&(t.first={order:r,placeholder:document.createComment(a),element:e.drawNightOrder(!0).firstElementChild}),n&&(t.other={order:n,placeholder:document.createComment(a),element:e.drawNightOrder(!1).firstElementChild}),this.data.push(t)}},{key:"placeInOrder",value:function(e){var t=this,r=this.getDataIndex(e);r<0||[["first","getFirstNight"],["other","getOtherNight"]].forEach(function(n){var a=ga(n,2),i=a[0],o=a[1],c=t.data[r][i];if(c){var u=t.data.filter(function(e){return e[i]}).sort(function(e,t){return e[i].order-t[i].order}).find(function(t){return t.order>e[o]()}),s=t.shouldShow(c)?c.element:c.placeholder;u?t.holders[i].insertBefore(s,u.element.parentElement?u.element:u.placeholder):t.holders[i].append(s)}})}},{key:"unsetCharacter",value:function(e){var t=this,r=this.getDataIndex(e);r<0||(["first","other"].forEach(function(e){var n=t.data[r][e];n&&(n.placeholder.remove(),n.element.remove())}),this.data.splice(r,1))}},{key:"drawNightOrder",value:function(e){var t=this,r=this.data,n=e?"first":"other";return r.filter(function(e){return e[n]}).sort(function(e,t){return e[n].order-t[n].order}).reduce(function(e,r){var a=r[n],i=a.element,o=a.placeholder;return e.append(t.shouldShow(r)?i:o),e},document.createDocumentFragment())}},{key:"drawAllNightOrders",value:function(){var e=this;Object.entries(this.holders).forEach(function(t){var r=ga(t,2),n=r[0],a=r[1];a&&(0,c.Ie)(a).append(e.drawNightOrder("first"===n))})}},{key:"drawCharacter",value:function(e){this.drawCharacterByData(this.getData(e))}},{key:"drawCharacterByData",value:function(e){var t=this,r=this.shouldShow(e);["first","other"].forEach(function(n){if(e[n]){var a=e[n],i=a.placeholder,o=a.element;o.classList.toggle("is-in-play",t.isInPlay(e)),o.classList.toggle("is-dead",t.isDead(e)),r&&i.parentElement?i.replaceWith(o):!r&&o.parentElement&&o.replaceWith(i)}})}},{key:"drawAllCharacters",value:function(){var e=this;this.data.forEach(function(t){return e.drawCharacterByData(t)})}},{key:"isDead",value:function(e){return e.inPlay>0&&0===e.alive}},{key:"isInPlay",value:function(e){return e.inPlay>0}},{key:"shouldShow",value:function(e){var t=this.showDead,r=this.showNotInPlay,n=this.isDead(e),a=this.isInPlay(e);return a&&!n||!a&&r||n&&t}},{key:"getDataIndex",value:function(e){var t=e.getId();return this.data.findIndex(function(e){return e.character.getId()===t})}},{key:"getData",value:function(e){var t=this.getDataIndex(e);if(t<0)throw new ReferenceError('Cannot find character "'.concat(e.getId(),'"'));return this.data[t]}},{key:"hasCharacter",value:function(e){return this.getDataIndex(e)>-1}},{key:"addCharacter",value:function(e){var t=this.getData(e);this.adjustInPlay(t,1),e.getIsDead()||this.adjustAlive(t,1),this.drawCharacterByData(t)}},{key:"removeCharacter",value:function(e){var t=this.getData(e);e.getIsDead()||this.adjustAlive(t,-1),this.adjustInPlay(t,-1),this.drawCharacterByData(t)}},{key:"toggleDead",value:function(e,t){var r=this.getData(e);this.adjustAlive(r,t?-1:1),this.drawCharacterByData(r)}},{key:"adjustAlive",value:function(e,t){e.alive=Math.min(e.inPlay,Math.max(e.alive+t,0))}},{key:"adjustInPlay",value:function(e,t){e.inPlay=Math.max(0,e.inPlay+t)}}])}(),Oa=k.create("game"),Ea=k.create("token"),Ia=new Sa;Ia.setHolders({first:(0,c.pb)("#first-night"),other:(0,c.pb)("#other-nights")}),Oa.on("characters-selected",function(e){var t=e.detail;Ia.reset(),Ia.setCharacters(t.characters.filter(function(e){return!["fabled","traveller"].includes(e.getTeam())})),Ia.drawAllNightOrders()}),Oa.on("clear",function(){(0,c.pb)(".js--night-order--carousel").scrollLeft=0});var Pa={fabled:Object.create(null),traveller:Object.create(null)};Ea.on("character-add",function(e){var t=e.detail.character,r=t.getTeam();if(Pa[r]){var n=t.getId();Pa[r][n]||(Pa[r][n]=0),Pa[r][n]+=1,Ia.setCharacter(t),Ia.placeInOrder(t)}Ia.hasCharacter(t)&&Ia.addCharacter(t)}),Ea.on("character-remove",function(e){var t=e.detail.character,r=t.getTeam();if(Pa[r]){var n=t.getId();Pa[r][n]&&(Pa[r][n]-=1,Pa[r][n]<=0&&(Ia.unsetCharacter(t),delete Pa[r][n]))}Ia.hasCharacter(t)&&Ia.removeCharacter(t)}),Ea.on("shroud-toggle",function(e){var t=e.detail;Ia.hasCharacter(t.character)&&Ia.toggleDead(t.character,t.isDead)});var Ta=(0,c.bF)("#show-dead");Ta.addEventListener("change",function(e){var t=e.target.checked;Ia.setShowDead(t),Oa.trigger("night-order-show-dead",{showDead:t})}),(0,c.bF)("#show-all").addEventListener("change",function(e){var t=e.target.checked;Ia.setShowNotInPlay(t),Oa.trigger("night-order-show-all",{showAll:t}),t&&!Ta.checked&&(Ta.checked=!0,(0,c.cm)(Ta))});var Ca=(0,c.bF)("#info-token-button-holder"),xa=(0,c.bF)("#info-token-dialog-holder");re.setTemplates({button:p.create((0,c.bF)("#info-token-button-template")),dialog:p.create((0,c.bF)("#info-token-dialog-template"))}),re.setHolders({button:Ca,custom:(0,c.bF)("#info-token-custom-holder"),dialog:xa}),JSON.parse(Ca.dataset.infoTokens).forEach(function(e){new re(e).draw()});var Aa=k.create("info-token");(0,c.bF)("#add-info-token").addEventListener("click",function(){var e=window.prompt(window.I18N.customInfoToken);if(e){var t=new re({raw:e,custom:!0});t.draw(),Aa.trigger("info-token-added",{token:t})}});var La=new WeakMap;function Da(e){Ee.A.create(e.getDialog()).hide(),e.remove(),Aa.trigger("info-token-deleted",{token:e})}Aa.on("info-token-added",function(e){var t=e.detail.token;La.set(t.getDialog(),t)}),xa.addEventListener("click",function(e){var t=e.target.closest("button[data-action]");if(t){var r=La.get(t.closest(".js--info-token--dialog"));if(r)switch(t.dataset.action){case"edit":var n=r.getData(),a=window.prompt(window.I18N.customInfoToken,n.raw);a?function(e,t){e.updateRaw(t),Aa.trigger("info-token-updated",{token:e})}(r,a):Da(r);break;case"delete":Da(r)}}});var Na=(0,c.bF)("#clear-st-notes"),Fa=(0,c.bF)("#st-notes");Na.addEventListener("click",function(){window.confirm(Na.dataset.warning)&&(Fa.value="",(0,c.cm)(Fa))});var Ra="0.9.44";function Ba(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return _a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}(0,c.bF)("#version").textContent=Ra;var Va=ye.create("pocket-grimoire"),Ga=k.create("game"),Ua=k.create("token"),Ma=k.create("info-token"),Ha=(0,c.pb)(".js--pad"),Ja=Ha.pad,za=Le.create();Ga.on("characters-selected",function(e){var t=e.detail;Va.setCharacters(t.name,t.characters.map(function(e){return e.isCustom()?e.getAllData():e.getId()}),t.game),Va.removeStaleInputs()}),Ga.on("pad-height-change",function(e){var t=e.detail;Va.setHeight(t.height)}),Ua.on("character-add",function(e){var t=e.detail;Va.addToken(t.character)}),Ua.on("character-remove",function(e){var t=e.detail;Va.removeToken(t.character)}),Ua.on("reminder-add",function(e){var t=e.detail;Va.addToken(t.reminder)}),Ua.on("reminder-remove",function(e){var t=e.detail;Va.removeToken(t.reminder)}),Ua.on("move",function(e){var t=e.detail,r=t.element,n=t.left,a=t.top,i=t.zIndex,o=Ja.getCharacterByToken(r)||Ja.getReminderByToken(r);o&&Va.moveToken(o,n,a,i)}),Ua.on("zindex",function(e){var t=e.detail,r=t.element,n=t.zIndex,a=Ja.getCharacterByToken(r)||Ja.getReminderByToken(r);a&&Va.alignToken(a,n)}),Ua.on("shroud-toggle",function(e){var t=e.detail;Va.toggleDead(Ja.getCharacterByToken(t.token),t.isDead)}),Ua.on("rotate-toggle",function(e){var t=e.detail;Va.rotate(Ja.getCharacterByToken(t.token),t.isUpsideDown)}),Ua.on("set-player-name",function(e){var t=e.detail;Va.setPlayerName(Ja.getCharacterByToken(t.token),t.name),za.add(t.name)}),Ua.on("ghost-vote-toggle",function(e){var t=e.detail;Va.setGhostVote(Ja.getCharacterByToken(t.token),t.hasGhostVote)}),Ua.on("bluff",function(e){var t=e.detail;Va.setBluffs(t.data)}),Ma.on("info-token-added",function(e){var t=e.detail;Va.saveInfoToken(t.token,t.index)}),Ma.on("info-token-updated",function(e){var t=e.detail;Va.updateInfoToken(t.token)}),Ma.on("info-token-deleted",function(e){var t=e.detail;Va.removeInfoToken(t.token)});var $a,qa,Wa,Ya=Va.getVersion();Ya&&-1!==($a=Ra,qa=ft(Ya),Wa=ft($a),lt(-1,qa.reduce(function(e,t,r){return 0===e&&(e=t-Wa[r]),e},0),1))||(Ya&&window.confirm(I18N.versionChange)&&Ee.A.create((0,c.pb)("#clear-cache")).show(),Va.setVersion(Ra));var Xa=document.body;Xa.addEventListener("input",function(e){var t=e.target.closest("input,select,textarea");t.hasAttribute("data-no-store")||Va.saveInput(t)}),Xa.addEventListener("toggle",function(e){var t=e.target;Va.saveDetails(t.closest("details"))},{capture:!0});var Za=Va.read();Oe.ready(function(e){var t=Za.characters;t&&t.characters&&t.characters.length&&Ga.trigger("characters-selected",{name:t.name,characters:t.characters.map(function(t){return e.getCharacter("string"==typeof t?t:t.id)||e.createCustomCharacter(t)}).filter(Boolean),game:t.game});var r=0;Za.tokens.forEach(function(t){var n=t.id,a=t.left,i=t.top,o=t.zIndex,c=t.isDead,u=t.isUpsideDown,s=t.playerName,l=t.ghostVote,f=Oe.isCharacterId(n),d=f?Ja.addCharacter(e.getCharacterClone(n)):Ja.addReminder(e.getReminderClone(n)),h=d.token,v=d.character;Ja.moveToken(h,a,i,o),f&&(Ja.toggleDead(v,Boolean(c)),Ja.rotate(v,Boolean(u)),Ja.setPlayerName(v,s),Ja.setGhostVote(v,Boolean(l))),o>r&&(r=o)}),Ja.setZIndex(r);var n=Za.bluffs;if(Object.keys(n).length||(n=Nn.getEmptyData()),"string"==typeof n["#bluff-1"]){var a=Nn.getEmptyData();a.groups[0].set=Object.values(n),n=a}Nn.get().ready(n),Object.entries(Za.inputs).forEach(function(e){var t,r=Ba(e,2),n=r[0],a=r[1],i=(0,c.$I)(n),o=null===(t=i[0])||void 0===t?void 0:t.type,u="radio"===o,s=u?i.find(function(e){return e.value===a}):i[0];s&&(u?s.checked=!0:"checkbox"===o?s.checked=a:s.value=a,(0,c.cm)(s))}),Ga.trigger("inputs-repopulated"),Object.entries(Za.details).forEach(function(e){var t=Ba(e,2),r=t[0],n=t[1],a=(0,c.bF)(r);if(a){var i=a.hasAttribute("open");a.open=n,i!==n&&a.dispatchEvent(new Event("toggle",{bubbles:!1}))}}),Za.height&&(Ha.style.height=Za.height),Za.infoTokens.forEach(function(e,t){var r=new re({raw:e,custom:!0});r.draw(),Ma.trigger("info-token-added",{token:r,index:t})})})}},e=>{e.O(0,[715],()=>{return t=5148,e(e.s=t);var t});e.O()}]);
//# sourceMappingURL=main.91b41bbb.js.map